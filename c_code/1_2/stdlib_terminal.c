/* Generated by Nim Compiler v0.13.0 */
/*   (c) 2015 Andreas Rumpf */
/* The generated code is subject to the original license. */
#define NIM_INTBITS 64

#include "nimbase.h"
#include <string.h>
#include <stdio.h>
#include <io.h>
typedef struct TGenericSeq TGenericSeq;
typedef struct NimStringDesc NimStringDesc;
typedef struct Consolescreenbufferinfo179018 Consolescreenbufferinfo179018;
typedef struct Coord179014 Coord179014;
typedef struct Smallrect179016 Smallrect179016;
typedef N_STDCALL_PTR(NI, TY106621) (NI32 nstdhandle);
struct  TGenericSeq  {
NI len;
NI reserved;
};
struct  NimStringDesc  {
  TGenericSeq Sup;
NIM_CHAR data[SEQ_DECL_SIZE];
};
typedef N_STDCALL_PTR(NI32, TY179031) (NI hsourceprocesshandle, NI hsourcehandle, NI htargetprocesshandle, NI* lptargethandle, NI32 dwdesiredaccess, NI32 binherithandle, NI32 dwoptions);
typedef N_STDCALL_PTR(NI, TY179041) (void);
struct  Coord179014  {
NI16 X;
NI16 Y;
};
struct  Smallrect179016  {
NI16 Left;
NI16 Top;
NI16 Right;
NI16 Bottom;
};
struct  Consolescreenbufferinfo179018  {
Coord179014 dwsize;
Coord179014 dwcursorposition;
NI16 wattributes;
Smallrect179016 srwindow;
Coord179014 dwmaximumwindowsize;
};
typedef N_STDCALL_PTR(NI32, TY179043) (NI hconsoleoutput, Consolescreenbufferinfo179018* lpconsolescreenbufferinfo);
typedef N_STDCALL_PTR(NI32, TY179068) (NI hconsoleoutput, NI16 wattributes);
typedef NI TY182818[8];
N_NIMCALL(void*, nimLoadLibrary)(NimStringDesc* path);
N_NOINLINE(void, nimLoadLibraryError)(NimStringDesc* path);
N_NIMCALL(void*, nimGetProcAddr)(void* lib, NCSTRING name);
N_NIMCALL(NI16, getattributes_179421)(NI h);
STRING_LITERAL(TMP147, "kernel32", 8);
STRING_LITERAL(TMP148, "kernel32", 8);
NIM_CONST TY182818 lookup_182815 = {((NI) 0),
((NI) 4),
((NI) 2),
((NI) 6),
((NI) 1),
((NI) 5),
((NI) 3),
((NI) 7)}
;
NI hstdout_179071;
NI hstderr_179072;
NI hstdouttemp_179073;
extern TY106621 Dl_106620;
static void* TMP146;
TY179031 Dl_179030;
TY179041 Dl_179040;
NI hstderrtemp_179201;
NI16 oldstdoutattr_179428;
TY179043 Dl_179042;
NI16 oldstderrattr_179429;
TY179068 Dl_179067;

N_NIMCALL(NI16, getattributes_179421)(NI h) {
	NI16 result;
	Consolescreenbufferinfo179018 c;
{	result = 0;
	memset((void*)(&c), 0, sizeof(c));
	{
		NI32 LOC3;
		LOC3 = 0;
		LOC3 = Dl_179042(h, (&c));
		if (!!((LOC3 == ((NI32) 0)))) goto LA4;
		result = c.wattributes;
		goto BeforeRet;
	}
	LA4: ;
	result = ((NI16) 112);
	goto BeforeRet;
	}BeforeRet: ;
	return result;
}

N_NIMCALL(void, setstyle_182201)(FILE* f, NU8 style) {
	NI h;
	NI16 a;
	NI32 LOC22;
	{
		if (!(f == stderr)) goto LA3;
		h = hstderr_179072;
	}
	goto LA1;
	LA3: ;
	{
		h = hstdout_179071;
	}
	LA1: ;
	a = ((NI16) 0);
	{
		if (!((style &(1U<<((NU)((((NU8) 1)- 1))&7U)))!=0)) goto LA8;
		a = (NI16)(a | ((NI16) 8));
	}
	LA8: ;
	{
		if (!((style &(1U<<((NU)((((NU8) 5)- 1))&7U)))!=0)) goto LA12;
		a = (NI16)(a | ((NI16) 128));
	}
	LA12: ;
	{
		if (!((style &(1U<<((NU)((((NU8) 7)- 1))&7U)))!=0)) goto LA16;
		a = (NI16)(a | ((NI16) 16384));
	}
	LA16: ;
	{
		if (!((style &(1U<<((NU)((((NU8) 4)- 1))&7U)))!=0)) goto LA20;
		a = (NI16)(a | ((NI16) -32768));
	}
	LA20: ;
	LOC22 = 0;
	LOC22 = Dl_179067(h, a);
}

N_NIMCALL(void, resetattributes_181825)(FILE* f) {
	{
		NI32 LOC5;
		if (!(f == stderr)) goto LA3;
		LOC5 = 0;
		LOC5 = Dl_179067(hstderr_179072, oldstderrattr_179429);
	}
	goto LA1;
	LA3: ;
	{
		NI32 LOC7;
		LOC7 = 0;
		LOC7 = Dl_179067(hstdout_179071, oldstdoutattr_179428);
	}
	LA1: ;
}

N_NIMCALL(void, setforegroundcolor_182627)(FILE* f, NU8 fg, NIM_BOOL bright) {
	NI h;
	NI16 old;
	NI16 LOC6;
	NI32 LOC11;
	{
		if (!(f == stderr)) goto LA3;
		h = hstderr_179072;
	}
	goto LA1;
	LA3: ;
	{
		h = hstdout_179071;
	}
	LA1: ;
	LOC6 = 0;
	LOC6 = getattributes_179421(h);
	old = (NI16)(LOC6 & ((NI16) -8));
	{
		if (!bright) goto LA9;
		old = (NI16)(old | ((NI16) 8));
	}
	LA9: ;
	LOC11 = 0;
	LOC11 = Dl_179067(h, ((NI16)(NU16)(NU)((NI)(((NI) (old)) | lookup_182815[(fg)- 30]))));
}

N_NIMCALL(NIM_BOOL, isatty_183025)(FILE* f) {
	NIM_BOOL result;
	int LOC1;
	int LOC2;
	result = 0;
	LOC1 = 0;
	LOC1 = fileno(f);
	LOC2 = 0;
	LOC2 = _isatty(LOC1);
	result = !((LOC2 == ((NI32) 0)));
	return result;
}
NIM_EXTERNC N_NOINLINE(void, stdlib_terminalInit000)(void) {
	{
		hstdouttemp_179073 = Dl_106620(((NI32) -11));
		{
			NI LOC4;
			NI LOC5;
			NI32 LOC6;
			LOC4 = 0;
			LOC4 = Dl_179040();
			LOC5 = 0;
			LOC5 = Dl_179040();
			LOC6 = 0;
			LOC6 = Dl_179030(LOC4, hstdouttemp_179073, LOC5, (&hstdout_179071), ((NI32) 0), ((NI32) 1), ((NI32) 2));
			if (!(LOC6 == ((NI32) 0))) goto LA7;
		}
		LA7: ;
		hstderrtemp_179201 = Dl_106620(((NI32) -12));
		{
			NI LOC11;
			NI LOC12;
			NI32 LOC13;
			LOC11 = 0;
			LOC11 = Dl_179040();
			LOC12 = 0;
			LOC12 = Dl_179040();
			LOC13 = 0;
			LOC13 = Dl_179030(LOC11, hstderrtemp_179201, LOC12, (&hstderr_179072), ((NI32) 0), ((NI32) 1), ((NI32) 2));
			if (!(LOC13 == ((NI32) 0))) goto LA14;
		}
		LA14: ;
	}
	oldstdoutattr_179428 = getattributes_179421(hstdout_179071);
	oldstderrattr_179429 = getattributes_179421(hstderr_179072);
}

NIM_EXTERNC N_NOINLINE(void, stdlib_terminalDatInit000)(void) {
if (!((TMP146 = nimLoadLibrary((NimStringDesc*) &TMP147))
)) nimLoadLibraryError((NimStringDesc*) &TMP148);
	Dl_179030 = (TY179031) nimGetProcAddr(TMP146, "DuplicateHandle");
	Dl_179040 = (TY179041) nimGetProcAddr(TMP146, "GetCurrentProcess");
	Dl_179042 = (TY179043) nimGetProcAddr(TMP146, "GetConsoleScreenBufferInfo");
	Dl_179067 = (TY179068) nimGetProcAddr(TMP146, "SetConsoleTextAttribute");
}

