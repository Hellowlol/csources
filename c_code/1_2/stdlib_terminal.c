/* Generated by Nim Compiler v0.14.3 */
/*   (c) 2016 Andreas Rumpf */
/* The generated code is subject to the original license. */
#define NIM_INTBITS 64

#include "nimbase.h"
#include <string.h>
#include <stdio.h>
#include <io.h>
typedef struct TGenericSeq TGenericSeq;
typedef struct NimStringDesc NimStringDesc;
typedef struct Consolescreenbufferinfo184018 Consolescreenbufferinfo184018;
typedef struct Coord184014 Coord184014;
typedef struct Smallrect184016 Smallrect184016;
typedef N_STDCALL_PTR(NI, TY114821) (NI32 nstdhandle0);
struct  TGenericSeq  {
NI len;
NI reserved;
};
struct  NimStringDesc  {
  TGenericSeq Sup;
NIM_CHAR data[SEQ_DECL_SIZE];
};
typedef N_STDCALL_PTR(NI32, TY184031) (NI hsourceprocesshandle0, NI hsourcehandle0, NI htargetprocesshandle0, NI* lptargethandle0, NI32 dwdesiredaccess0, NI32 binherithandle0, NI32 dwoptions0);
typedef N_STDCALL_PTR(NI, TY184041) (void);
struct  Coord184014  {
NI16 X;
NI16 Y;
};
struct  Smallrect184016  {
NI16 Left;
NI16 Top;
NI16 Right;
NI16 Bottom;
};
struct  Consolescreenbufferinfo184018  {
Coord184014 dwsize;
Coord184014 dwcursorposition;
NI16 wattributes;
Smallrect184016 srwindow;
Coord184014 dwmaximumwindowsize;
};
typedef N_STDCALL_PTR(NI32, TY184043) (NI hconsoleoutput0, Consolescreenbufferinfo184018* lpconsolescreenbufferinfo0);
typedef NU8 Style187013Set;
typedef NU8 Style187013;
typedef N_STDCALL_PTR(NI32, TY184115) (NI hconsoleoutput0, NI16 wattributes0);
typedef NU8 Foregroundcolor187605;
typedef NI TY187818[8];
N_NIMCALL(void*, nimLoadLibrary)(NimStringDesc* path0);
N_NOINLINE(void, nimLoadLibraryError)(NimStringDesc* path0);
N_NIMCALL(void*, nimGetProcAddr)(void* lib0, NCSTRING name0);
N_NIMCALL(NI16, getattributes_184421_4182131368)(NI h0);
N_NIMCALL(int, getfilehandle_14990_1689653243)(FILE* f0);
STRING_LITERAL(T4182131368_4, "kernel32", 8);
STRING_LITERAL(T4182131368_5, "kernel32", 8);
NIM_CONST TY187818 lookup_187815_4182131368 = {((NI) 0),
((NI) 4),
((NI) 2),
((NI) 6),
((NI) 1),
((NI) 5),
((NI) 3),
((NI) 7)}
;
NI hstdout_184118_4182131368;
NI hstderr_184119_4182131368;
NI hstdouttemp_184120_4182131368;
extern TY114821 Dl_114820;
static void* T4182131368_2;
TY184031 Dl_184030;
TY184041 Dl_184040;
NI hstderrtemp_184201_4182131368;
NI16 oldstdoutattr_184428_4182131368;
TY184043 Dl_184042;
NI16 oldstderrattr_184429_4182131368;
TY184115 Dl_184114;

N_NIMCALL(NI16, getattributes_184421_4182131368)(NI h0) {
	NI16 result0;
	Consolescreenbufferinfo184018 c0;
{	result0 = (NI16)0;
	memset((void*)(&c0), 0, sizeof(c0));
	{
		NI32 LOC3;
		LOC3 = (NI32)0;
		LOC3 = Dl_184042(h0, (&c0));
		if (!!((LOC3 == ((NI32) 0)))) goto LA4;
		result0 = c0.wattributes;
		goto BeforeRet;
	}
	LA4: ;
	result0 = ((NI16) 112);
	goto BeforeRet;
	}BeforeRet: ;
	return result0;
}

N_NIMCALL(void, setstyle_187201_4182131368)(FILE* f0, Style187013Set style0) {
	NI h0;
	NI16 a0;
	NI32 LOC22;
	{
		if (!(f0 == stderr)) goto LA3;
		h0 = hstderr_184119_4182131368;
	}
	goto LA1;
	LA3: ;
	{
		h0 = hstdout_184118_4182131368;
	}
	LA1: ;
	a0 = ((NI16) 0);
	{
		if (!((style0 &(1U<<((NU)((((Style187013) 1)- 1))&7U)))!=0)) goto LA8;
		a0 = (NI16)(a0 | ((NI16) 8));
	}
	LA8: ;
	{
		if (!((style0 &(1U<<((NU)((((Style187013) 5)- 1))&7U)))!=0)) goto LA12;
		a0 = (NI16)(a0 | ((NI16) 128));
	}
	LA12: ;
	{
		if (!((style0 &(1U<<((NU)((((Style187013) 7)- 1))&7U)))!=0)) goto LA16;
		a0 = (NI16)(a0 | ((NI16) 16384));
	}
	LA16: ;
	{
		if (!((style0 &(1U<<((NU)((((Style187013) 4)- 1))&7U)))!=0)) goto LA20;
		a0 = (NI16)(a0 | ((NI16) -32768));
	}
	LA20: ;
	LOC22 = (NI32)0;
	LOC22 = Dl_184114(h0, a0);
}

N_NIMCALL(void, resetattributes_186825_4182131368)(FILE* f0) {
	{
		NI32 LOC5;
		if (!(f0 == stderr)) goto LA3;
		LOC5 = (NI32)0;
		LOC5 = Dl_184114(hstderr_184119_4182131368, oldstderrattr_184429_4182131368);
	}
	goto LA1;
	LA3: ;
	{
		NI32 LOC7;
		LOC7 = (NI32)0;
		LOC7 = Dl_184114(hstdout_184118_4182131368, oldstdoutattr_184428_4182131368);
	}
	LA1: ;
}

N_NIMCALL(void, setforegroundcolor_187629_4182131368)(FILE* f0, Foregroundcolor187605 fg0, NIM_BOOL bright0) {
	NI h0;
	NI16 old0;
	NI16 LOC6;
	NI32 LOC11;
	{
		if (!(f0 == stderr)) goto LA3;
		h0 = hstderr_184119_4182131368;
	}
	goto LA1;
	LA3: ;
	{
		h0 = hstdout_184118_4182131368;
	}
	LA1: ;
	LOC6 = (NI16)0;
	LOC6 = getattributes_184421_4182131368(h0);
	old0 = (NI16)(LOC6 & ((NI16) -8));
	{
		if (!bright0) goto LA9;
		old0 = (NI16)(old0 | ((NI16) 8));
	}
	LA9: ;
	LOC11 = (NI32)0;
	LOC11 = Dl_184114(h0, ((NI16)(NU16)(NU)((NI)(((NI) (old0)) | lookup_187815_4182131368[(fg0)- 30]))));
}

N_NIMCALL(NIM_BOOL, isatty_188025_4182131368)(FILE* f0) {
	NIM_BOOL result0;
	int LOC1;
	int LOC2;
	result0 = (NIM_BOOL)0;
	LOC1 = (int)0;
	LOC1 = getfilehandle_14990_1689653243(f0);
	LOC2 = (int)0;
	LOC2 = _isatty(LOC1);
	result0 = !((LOC2 == ((NI32) 0)));
	return result0;
}
NIM_EXTERNC N_NOINLINE(void, stdlib_terminalInit000)(void) {
	{
		hstdouttemp_184120_4182131368 = Dl_114820(((NI32) -11));
		{
			NI LOC4;
			NI LOC5;
			NI32 LOC6;
			LOC4 = (NI)0;
			LOC4 = Dl_184040();
			LOC5 = (NI)0;
			LOC5 = Dl_184040();
			LOC6 = (NI32)0;
			LOC6 = Dl_184030(LOC4, hstdouttemp_184120_4182131368, LOC5, (&hstdout_184118_4182131368), ((NI32) 0), ((NI32) 1), ((NI32) 2));
			if (!(LOC6 == ((NI32) 0))) goto LA7;
		}
		LA7: ;
		hstderrtemp_184201_4182131368 = Dl_114820(((NI32) -12));
		{
			NI LOC11;
			NI LOC12;
			NI32 LOC13;
			LOC11 = (NI)0;
			LOC11 = Dl_184040();
			LOC12 = (NI)0;
			LOC12 = Dl_184040();
			LOC13 = (NI32)0;
			LOC13 = Dl_184030(LOC11, hstderrtemp_184201_4182131368, LOC12, (&hstderr_184119_4182131368), ((NI32) 0), ((NI32) 1), ((NI32) 2));
			if (!(LOC13 == ((NI32) 0))) goto LA14;
		}
		LA14: ;
	}
	oldstdoutattr_184428_4182131368 = getattributes_184421_4182131368(hstdout_184118_4182131368);
	oldstderrattr_184429_4182131368 = getattributes_184421_4182131368(hstderr_184119_4182131368);
}

NIM_EXTERNC N_NOINLINE(void, stdlib_terminalDatInit000)(void) {
if (!((T4182131368_2 = nimLoadLibrary((NimStringDesc*) &T4182131368_4))
)) nimLoadLibraryError((NimStringDesc*) &T4182131368_5);
	Dl_184030 = (TY184031) nimGetProcAddr(T4182131368_2, "DuplicateHandle");
	Dl_184040 = (TY184041) nimGetProcAddr(T4182131368_2, "GetCurrentProcess");
	Dl_184042 = (TY184043) nimGetProcAddr(T4182131368_2, "GetConsoleScreenBufferInfo");
	Dl_184114 = (TY184115) nimGetProcAddr(T4182131368_2, "SetConsoleTextAttribute");
}

