/* Generated by Nimrod Compiler v0.9.3 */
/*   (c) 2012 Andreas Rumpf */
/* The generated code is subject to the original license. */
#define NIM_INTBITS 32
#include "nimbase.h"

#include <string.h>

#include <sys/types.h>

#include <unistd.h>

#include <spawn.h>

#include <signal.h>

#include <stdio.h>

#include <sys/wait.h>

#include <sys/select.h>
typedef struct NimStringDesc NimStringDesc;
typedef struct TGenericSeq TGenericSeq;
typedef struct tprocess145203 tprocess145203;
typedef struct TY9552 TY9552;
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct tcell38848 tcell38848;
typedef struct tcellseq38864 tcellseq38864;
typedef struct tgcheap40816 tgcheap40816;
typedef struct tcellset38860 tcellset38860;
typedef struct tpagedesc38856 tpagedesc38856;
typedef struct tmemregion22210 tmemregion22210;
typedef struct tsmallchunk21438 tsmallchunk21438;
typedef struct tllchunk22204 tllchunk22204;
typedef struct tbigchunk21440 tbigchunk21440;
typedef struct tintset21415 tintset21415;
typedef struct ttrunk21411 ttrunk21411;
typedef struct tavlnode22208 tavlnode22208;
typedef struct tgcstat40814 tgcstat40814;
typedef struct TNimObject TNimObject;
typedef struct tstream143629 tstream143629;
typedef struct TY146202 TY146202;
typedef struct tstringtable112610 tstringtable112610;
typedef struct tkeyvaluepairseq112608 tkeyvaluepairseq112608;
typedef struct TY87905 TY87905;
typedef struct tfilestream144109 tfilestream144109;
typedef struct TY75888 TY75888;
typedef struct tbasechunk21436 tbasechunk21436;
typedef struct tfreecell21428 tfreecell21428;
struct TGenericSeq {
NI len;
NI reserved;
};
typedef NIM_CHAR TY611[100000001];
struct NimStringDesc {
  TGenericSeq Sup;
TY611 data;
};
typedef NU8 TY113118[32];
typedef N_NIMCALL_PTR(void, TY889) (void* p, NI op);
struct TNimType {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
TY889 marker;
};
struct TNimNode {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct tcell38848 {
NI Refcount;
TNimType* Typ;
};
struct tcellseq38864 {
NI Len;
NI Cap;
tcell38848** D;
};
struct tcellset38860 {
NI Counter;
NI Max;
tpagedesc38856* Head;
tpagedesc38856** Data;
};
typedef tsmallchunk21438* TY22222[512];
typedef ttrunk21411* ttrunkbuckets21413[256];
struct tintset21415 {
ttrunkbuckets21413 Data;
};
struct tmemregion22210 {
NI Minlargeobj;
NI Maxlargeobj;
TY22222 Freesmallchunks;
tllchunk22204* Llmem;
NI Currmem;
NI Maxmem;
NI Freemem;
NI Lastsize;
tbigchunk21440* Freechunkslist;
tintset21415 Chunkstarts;
tavlnode22208* Root;
tavlnode22208* Deleted;
tavlnode22208* Last;
tavlnode22208* Freeavlnodes;
};
struct tgcstat40814 {
NI Stackscans;
NI Cyclecollections;
NI Maxthreshold;
NI Maxstacksize;
NI Maxstackcells;
NI Cycletablesize;
NI64 Maxpause;
};
struct tgcheap40816 {
void* Stackbottom;
NI Cyclethreshold;
tcellseq38864 Zct;
tcellseq38864 Decstack;
tcellset38860 Cycleroots;
tcellseq38864 Tempstack;
NI Recgclock;
tmemregion22210 Region;
tgcstat40814 Stat;
};
struct TNimObject {
TNimType* m_type;
};
struct tprocess145203 {
  TNimObject Sup;
int Inhandle;
int Outhandle;
int Errhandle;
tstream143629* Instream;
tstream143629* Outstream;
tstream143629* Errstream;
pid_t Id;
int Exitcode;
};
struct TY87905 {
NimStringDesc* Field0;
NimStringDesc* Field1;
};
struct tstringtable112610 {
  TNimObject Sup;
NI Counter;
tkeyvaluepairseq112608* Data;
NU8 Mode;
};
typedef int TY146798[2];
typedef NimStringDesc* TY114525[1];
typedef NimStringDesc* TY114486[2];
struct TY75888 {
NimStringDesc* Field0;
NI Field1;
};
typedef NI TY21418[16];
struct tpagedesc38856 {
tpagedesc38856* Next;
NI Key;
TY21418 Bits;
};
struct tbasechunk21436 {
NI Prevsize;
NI Size;
NIM_BOOL Used;
};
struct tsmallchunk21438 {
  tbasechunk21436 Sup;
tsmallchunk21438* Next;
tsmallchunk21438* Prev;
tfreecell21428* Freelist;
NI Free;
NI Acc;
NF Data;
};
struct tllchunk22204 {
NI Size;
NI Acc;
tllchunk22204* Next;
};
struct tbigchunk21440 {
  tbasechunk21436 Sup;
tbigchunk21440* Next;
tbigchunk21440* Prev;
NI Align;
NF Data;
};
struct ttrunk21411 {
ttrunk21411* Next;
NI Key;
TY21418 Bits;
};
typedef tavlnode22208* TY22214[2];
struct tavlnode22208 {
TY22214 Link;
NI Key;
NI Upperbound;
NI Level;
};
typedef N_NIMCALL_PTR(void, TY143630) (tstream143629* s);
typedef N_NIMCALL_PTR(NIM_BOOL, TY143634) (tstream143629* s);
typedef N_NIMCALL_PTR(void, TY143638) (tstream143629* s, NI pos);
typedef N_NIMCALL_PTR(NI, TY143643) (tstream143629* s);
typedef N_NIMCALL_PTR(NI, TY143647) (tstream143629* s, void* buffer, NI buflen);
typedef N_NIMCALL_PTR(void, TY143653) (tstream143629* s, void* buffer, NI buflen);
typedef N_NIMCALL_PTR(void, TY143659) (tstream143629* s);
struct tstream143629 {
  TNimObject Sup;
TY143630 Closeimpl;
TY143634 Atendimpl;
TY143638 Setpositionimpl;
TY143643 Getpositionimpl;
TY143647 Readdataimpl;
TY143653 Writedataimpl;
TY143659 Flushimpl;
};
struct tfilestream144109 {
  tstream143629 Sup;
FILE* F;
};
struct tfreecell21428 {
tfreecell21428* Next;
NI Zerofield;
};
struct TY9552 {
  TGenericSeq Sup;
  NimStringDesc* data[SEQ_DECL_SIZE];
};
struct TY146202 {
  TGenericSeq Sup;
  tprocess145203* data[SEQ_DECL_SIZE];
};
struct tkeyvaluepairseq112608 {
  TGenericSeq Sup;
  TY87905 data[SEQ_DECL_SIZE];
};
N_NIMCALL(NimStringDesc*, nospquoteShellWindows)(NimStringDesc* s);
N_NIMCALL(NIM_BOOL, contains_84683)(NimStringDesc* s, TY113118 chars);
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* src);
static N_INLINE(void, appendString)(NimStringDesc* dest, NimStringDesc* src);
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* dest, NI addlen);
N_NOINLINE(void, raiseIndexError)(void);
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* s, NIM_CHAR c);
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* s, NI newlen);
static N_INLINE(NI, addInt)(NI a, NI b);
N_NOINLINE(void, raiseOverflow)(void);
static N_INLINE(void, nimFrame)(TFrame* s);
static N_INLINE(void, popFrame)(void);
N_NIMCALL(NimStringDesc*, nospquoteShellPosix)(NimStringDesc* s);
N_NIMCALL(NIM_BOOL, allcharsinset_84306)(NimStringDesc* s, TY113118 theset);
N_NIMCALL(NimStringDesc*, nsuReplaceStr)(NimStringDesc* s, NimStringDesc* sub, NimStringDesc* by);
N_NIMCALL(NimStringDesc*, rawNewString)(NI space);
N_NIMCALL(NimStringDesc*, nospquoteShell)(NimStringDesc* s);
N_NIMCALL(tprocess145203*, startcmd_145428)(NimStringDesc* command, NU8 options);
N_NIMCALL(TY9552*, nosparseCmdLine)(NimStringDesc* c);
static N_INLINE(NI, subInt)(NI a, NI b);
N_NIMCALL(void*, newSeq)(TNimType* typ, NI len);
N_NIMCALL(NimStringDesc*, copyStringRC1)(NimStringDesc* src);
static N_INLINE(void, nimGCunrefNoCycle)(void* p);
static N_INLINE(tcell38848*, usrtocell_42239)(void* usr);
static N_INLINE(void, rtladdzct_43802)(tcell38848* c);
N_NOINLINE(void, addzct_42215)(tcellseq38864* s, tcell38848* c);
N_NIMCALL(NI, nospprocessID)(tprocess145203* p);
N_NIMCALL(int, nospinputHandle)(tprocess145203* p);
N_NIMCALL(int, nospoutputHandle)(tprocess145203* p);
N_NIMCALL(int, nosperrorHandle)(tprocess145203* p);
N_NIMCALL(NI, nospcountProcessors)(void);
N_NIMCALL(NI, nospexecProcesses)(NimStringDesc** cmds, NI cmdsLen0, NU8 options_145808, NI n);
N_NIMCALL(void, hiddenraiseassert_76017)(NimStringDesc* msg);
N_NIMCALL(void, nimGCvisit)(void* d, NI op);
N_NIMCALL(void, TMP949)(void* p, NI op);
N_NIMCALL(void, TMP950)(void* p, NI op);
static N_INLINE(void, asgnRefNoCycle)(void** dest, void* src);
N_NIMCALL(void, nossleep)(NI milsecs);
N_NIMCALL(NimStringDesc*, nospexecProcess)(NimStringDesc* command, NU8 options);
N_NIMCALL(NimStringDesc*, rawNewString)(NI cap);
N_NIMCALL(NIM_BOOL, readline_143973)(tstream143629* s, NimStringDesc** line);
N_NIMCALL(NimStringDesc*, addcmdargs_146604)(NimStringDesc* command, NimStringDesc** args, NI argsLen0);
N_NIMCALL(NCSTRING*, tocstringarray_146626)(NimStringDesc** b, NI bLen0, NimStringDesc** a, NI aLen0);
N_NOCONV(void*, alloc0_4004)(NI size);
N_NIMCALL(NI, mulInt)(NI a, NI b);
N_NOCONV(void*, alloc_4001)(NI size);
N_NIMCALL(NCSTRING*, tocstringarray_146692)(tstringtable112610* t);
N_NIMCALL(NI, nstlen)(tstringtable112610* t);
N_NIMCALL(NCSTRING*, envtocstringarray_146723)(void);
N_NIMCALL(void, getenvvarsc_104202)(void);
N_NIMCALL(NI, nsuFindChar)(NimStringDesc* s, NIM_CHAR sub, NI start);
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* s, NI start_67823, NI last);
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* s, NI first, NI last);
N_NIMCALL(NimStringDesc*, copyStr)(NimStringDesc* s, NI start);
N_NIMCALL(NimStringDesc*, copyStr)(NimStringDesc* s, NI first);
N_NIMCALL(tprocess145203*, nospstartProcess)(NimStringDesc* command, NimStringDesc* workingdir, NimStringDesc** args, NI argsLen0, tstringtable112610* env, NU8 options);
N_NIMCALL(void*, newObj)(TNimType* typ, NI size);
N_NIMCALL(void, oserror_100005)(NI32 errorcode);
N_NIMCALL(NI32, oslasterror_100046)(void);
static N_INLINE(void, setcurrentdir_101803)(NimStringDesc* newdir);
N_NIMCALL(NimStringDesc*, nosextractFilename)(NimStringDesc* path);
N_NIMCALL(void, dealloccstringarray_9840)(NCSTRING* a);
N_NIMCALL(NimStringDesc*, nsuJoinSep)(NimStringDesc** a, NI aLen0, NimStringDesc* sep);
N_NIMCALL(void, nospclose)(tprocess145203* p);
N_NIMCALL(void, close_143675)(tstream143629* s);
N_NIMCALL(void, nospsuspend)(tprocess145203* p);
N_NIMCALL(void, nospresume)(tprocess145203* p);
N_NIMCALL(NIM_BOOL, nosprunning)(tprocess145203* p);
N_NIMCALL(void, nospterminate)(tprocess145203* p);
N_NIMCALL(NI, nospwaitForExit)(tprocess145203* p, NI timeout);
N_NIMCALL(NI, peekexitcode_145513)(tprocess145203* p);
N_NIMCALL(void, createstream_147260)(tstream143629** stream, NI32* handle, NU8 filemode);
N_NIMCALL(NIM_BOOL, open_9211)(FILE** f, int filehandle, NU8 mode);
N_NIMCALL(tfilestream144109*, newfilestream_144167)(FILE* f);
N_NIMCALL(void, unsureAsgnRef)(void** dest, void* src);
N_NIMCALL(tstream143629*, nospinputStream)(tprocess145203* p);
N_NIMCALL(tstream143629*, nospoutputStream)(tprocess145203* p);
N_NIMCALL(tstream143629*, nosperrorStream)(tprocess145203* p);
N_NIMCALL(NI, nospexecCmd)(NimStringDesc* command);
N_NIMCALL(void, createfdset_147336)(fd_set* fd, TY146202* s, NI* m);
N_NIMCALL(void, pruneprocessset_147391)(TY146202** s, fd_set* fd);
N_NIMCALL(TGenericSeq*, setLengthSeq)(TGenericSeq* seq, NI elemsize, NI newlen);
N_NIMCALL(NI, select_146502)(TY146202** readfds, NI timeout);
N_NIMCALL(void, execcmdex_147602)(NimStringDesc* command, NU8 options, TY75888* Result);
static NIM_CONST TY113118 TMP932 = {
0x00, 0x02, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}
;
STRING_LITERAL(TMP933, "", 0);
STRING_LITERAL(TMP934, "\"", 1);
STRING_LITERAL(TMP935, "\\\"", 2);
NIM_CONST TY113118 safeunixchars_145238 = {
0x00, 0x00, 0x00, 0x00, 0x20, 0xE8, 0xFF, 0x27,
0xFF, 0xFF, 0xFF, 0x87, 0xFE, 0xFF, 0xFF, 0x07,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}
;
STRING_LITERAL(TMP936, "\'\'", 2);
static NIM_CONST TY113118 TMP937 = {
0x00, 0x00, 0x00, 0x00, 0x20, 0xE8, 0xFF, 0x27,
0xFF, 0xFF, 0xFF, 0x87, 0xFE, 0xFF, 0xFF, 0x07,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}
;
STRING_LITERAL(TMP938, "\'", 1);
STRING_LITERAL(TMP942, "\'\"\'\"\'", 5);
STRING_LITERAL(TMP946, "0 < n ", 6);
STRING_LITERAL(TMP958, "", 0);
STRING_LITERAL(TMP959, "\012", 1);
STRING_LITERAL(TMP960, " ", 1);
STRING_LITERAL(TMP972, "=", 1);
STRING_LITERAL(TMP984, "sh", 2);
STRING_LITERAL(TMP985, "-c", 2);
NIM_CONST TY114486 TMP983 = {((NimStringDesc*) &TMP984),
((NimStringDesc*) &TMP985)}
;
NIM_CONST TY75888 TMP992 = {((NimStringDesc*) &TMP958),
-1}
;
extern TFrame* frameptr_12037;
extern TNimType NTI9552; /* seq[string] */
extern tgcheap40816 gch_40844;
extern TNimType NTI1009; /* TObject */
TNimType NTI145203; /* TProcess */
extern TNimType NTI9008; /* TFileHandle */
extern TNimType NTI143627; /* PStream */
extern TNimType NTI91457; /* TPid */
extern TNimType NTI3809; /* cint */
TNimType NTI145205; /* PProcess */
TNimType NTI146202; /* seq[PProcess] */
extern TY9552* environment_104029;

static N_INLINE(void, appendString)(NimStringDesc* dest, NimStringDesc* src) {
	memcpy(((NCSTRING) (&(*dest).data[((*dest).Sup.len)- 0])), ((NCSTRING) ((*src).data)), (NI32)((*src).Sup.len + 1));	(*dest).Sup.len += (*src).Sup.len;
}
static N_INLINE(NI, addInt)(NI a, NI b) {
	NI result;
	result = 0;
	result = (NI)((NU32)(a) + (NU32)(b));
	{
		NIM_BOOL LOC3;
		LOC3 = 0;
		LOC3 = (0 <= (NI)(result ^ a));
		if (LOC3) goto LA4;
		LOC3 = (0 <= (NI)(result ^ b));
		LA4: ;
		if (!LOC3) goto LA5;
		goto BeforeRet;
	}	LA5: ;
	raiseOverflow();	BeforeRet: ;	return result;
}
static N_INLINE(void, nimFrame)(TFrame* s) {
	(*s).prev = frameptr_12037;
	frameptr_12037 = s;
}
static N_INLINE(void, popFrame)(void) {
	frameptr_12037 = (*frameptr_12037).prev;
}
N_NIMCALL(NimStringDesc*, nospquoteShellWindows)(NimStringDesc* s) {
	NimStringDesc* result;
	NIM_BOOL needquote;
	NIM_BOOL LOC1;
	NimStringDesc* backslashbuff;
	NIM_CHAR c_145228;
	NI i_145230;
	nimfr("quoteShellWindows", "osproc.nim")
	result = 0;
	nimln(48, "osproc.nim");
	nimln(48, "osproc.nim");
	LOC1 = 0;
	nimln(730, "system.nim");
	LOC1 = contains_84683(s, TMP932);
	if (LOC1) goto LA2;
	nimln(48, "osproc.nim");
	nimln(48, "osproc.nim");
	LOC1 = (s->Sup.len == 0);
	LA2: ;
	needquote = LOC1;
	nimln(50, "osproc.nim");
	result = copyString(((NimStringDesc*) &TMP933));
	nimln(51, "osproc.nim");
	backslashbuff = copyString(((NimStringDesc*) &TMP933));
	nimln(52, "osproc.nim");
	{
		if (!needquote) goto LA5;
		nimln(53, "osproc.nim");
		result = resizeString(result, 1);
appendString(result, ((NimStringDesc*) &TMP934));
	}	LA5: ;
	c_145228 = 0;
	nimln(1400, "system.nim");
	i_145230 = 0;
	nimln(1401, "system.nim");
	while (1) {
		nimln(1401, "system.nim");
		nimln(1401, "system.nim");
		if (!(i_145230 < s->Sup.len)) goto LA7;
		nimln(1402, "system.nim");
		if ((NU)(i_145230) > (NU)(s->Sup.len)) raiseIndexError();
		c_145228 = s->data[i_145230];
		nimln(56, "osproc.nim");
		{
			nimln(56, "osproc.nim");
			if (!((NU8)(c_145228) == (NU8)(92))) goto LA10;
			nimln(57, "osproc.nim");
			backslashbuff = addChar(backslashbuff, c_145228);
		}		goto LA8;
		LA10: ;
		{
			nimln(58, "osproc.nim");
			if (!((NU8)(c_145228) == (NU8)(34))) goto LA13;
			nimln(59, "osproc.nim");
			result = resizeString(result, backslashbuff->Sup.len + 0);
appendString(result, backslashbuff);
			nimln(60, "osproc.nim");
			result = resizeString(result, backslashbuff->Sup.len + 0);
appendString(result, backslashbuff);
			nimln(61, "osproc.nim");
			backslashbuff = setLengthStr(backslashbuff, 0);
			nimln(62, "osproc.nim");
			result = resizeString(result, 2);
appendString(result, ((NimStringDesc*) &TMP935));
		}		goto LA8;
		LA13: ;
		{
			nimln(64, "osproc.nim");
			{
				nimln(698, "system.nim");
				nimln(698, "system.nim");
				nimln(64, "osproc.nim");
				if (!!((backslashbuff->Sup.len == 0))) goto LA18;
				nimln(65, "osproc.nim");
				result = resizeString(result, backslashbuff->Sup.len + 0);
appendString(result, backslashbuff);
				nimln(66, "osproc.nim");
				backslashbuff = setLengthStr(backslashbuff, 0);
			}			LA18: ;
			nimln(67, "osproc.nim");
			result = addChar(result, c_145228);
		}		LA8: ;
		nimln(1403, "system.nim");
		i_145230 = addInt(i_145230, 1);
	} LA7: ;
	nimln(69, "osproc.nim");
	{
		if (!needquote) goto LA22;
		nimln(70, "osproc.nim");
		result = resizeString(result, 1);
appendString(result, ((NimStringDesc*) &TMP934));
	}	LA22: ;
	popFrame();
	return result;
}
N_NIMCALL(NimStringDesc*, nospquoteShellPosix)(NimStringDesc* s) {
	NimStringDesc* result;
	NIM_BOOL safe;
	nimfr("quoteShellPosix", "osproc.nim")
	result = 0;
	nimln(77, "osproc.nim");
	{
		nimln(77, "osproc.nim");
		nimln(77, "osproc.nim");
		if (!(s->Sup.len == 0)) goto LA3;
		nimln(78, "osproc.nim");
		nimln(78, "osproc.nim");
		result = copyString(((NimStringDesc*) &TMP936));
		goto BeforeRet;
	}	LA3: ;
	nimln(80, "osproc.nim");
	safe = allcharsinset_84306(s, TMP937);
	nimln(82, "osproc.nim");
	{
		if (!safe) goto LA7;
		nimln(83, "osproc.nim");
		nimln(83, "osproc.nim");
		result = copyString(s);
		goto BeforeRet;
	}	goto LA5;
	LA7: ;
	{
		NimStringDesc* LOC10;
		NimStringDesc* LOC11;
		nimln(85, "osproc.nim");
		nimln(85, "osproc.nim");
		nimln(85, "osproc.nim");
		LOC10 = 0;
		nimln(85, "osproc.nim");
		LOC11 = 0;
		LOC11 = nsuReplaceStr(s, ((NimStringDesc*) &TMP938), ((NimStringDesc*) &TMP942));
		LOC10 = rawNewString(LOC11->Sup.len + 2);
appendString(LOC10, ((NimStringDesc*) &TMP938));
appendString(LOC10, LOC11);
appendString(LOC10, ((NimStringDesc*) &TMP938));
		result = LOC10;
		goto BeforeRet;
	}	LA5: ;
	BeforeRet: ;	popFrame();
	return result;
}
N_NIMCALL(NimStringDesc*, nospquoteShell)(NimStringDesc* s) {
	NimStringDesc* result;
	nimfr("quoteShell", "osproc.nim")
	result = 0;
	nimln(92, "osproc.nim");
	nimln(92, "osproc.nim");
	result = nospquoteShellPosix(s);
	goto BeforeRet;
	BeforeRet: ;	popFrame();
	return result;
}
static N_INLINE(NI, subInt)(NI a, NI b) {
	NI result;
	result = 0;
	result = (NI)((NU32)(a) - (NU32)(b));
	{
		NIM_BOOL LOC3;
		LOC3 = 0;
		LOC3 = (0 <= (NI)(result ^ a));
		if (LOC3) goto LA4;
		LOC3 = (0 <= (NI)(result ^ (NI)((NU32) ~(b))));
		LA4: ;
		if (!LOC3) goto LA5;
		goto BeforeRet;
	}	LA5: ;
	raiseOverflow();	BeforeRet: ;	return result;
}
static N_INLINE(tcell38848*, usrtocell_42239)(void* usr) {
	tcell38848* result;
	nimfr("usrToCell", "gc.nim")
	result = 0;
	nimln(116, "gc.nim");
	nimln(116, "gc.nim");
	nimln(116, "gc.nim");
	result = ((tcell38848*) ((NI)((NU32)(((NI) (usr))) - (NU32)(((NI)sizeof(tcell38848))))));
	popFrame();
	return result;
}
static N_INLINE(void, rtladdzct_43802)(tcell38848* c) {
	nimfr("rtlAddZCT", "gc.nim")
	nimln(197, "gc.nim");
	addzct_42215(&gch_40844.Zct, c);	popFrame();
}
static N_INLINE(void, nimGCunrefNoCycle)(void* p) {
	tcell38848* c;
	nimfr("nimGCunrefNoCycle", "gc.nim")
	nimln(231, "gc.nim");
	c = usrtocell_42239(p);
	nimln(233, "gc.nim");
	{
		nimln(165, "gc.nim");
		(*c).Refcount -= 8;
		nimln(166, "gc.nim");
		if (!((NU32)((*c).Refcount) < (NU32)(8))) goto LA3;
		nimln(234, "gc.nim");
		rtladdzct_43802(c);	}	LA3: ;
	popFrame();
}
N_NIMCALL(tprocess145203*, startcmd_145428)(NimStringDesc* command, NU8 options) {
	tprocess145203* result;
	TY9552* c;
	TY9552* a;
	NI TMP943;
	NI i_145473;
	NI HEX3Atmp_145475;
	NI TMP944;
	NI res_145477;
	nimfr("startCmd", "osproc.nim")
	result = 0;
	nimln(135, "osproc.nim");
	c = nosparseCmdLine(command);
	a = 0;
	nimln(137, "osproc.nim");
	nimln(137, "osproc.nim");
	nimln(137, "osproc.nim");
	TMP943 = subInt(c->Sup.len, 1);
	a = (TY9552*) newSeq((&NTI9552), (NI32)(TMP943));
	i_145473 = 0;
	HEX3Atmp_145475 = 0;
	nimln(138, "osproc.nim");
	nimln(138, "osproc.nim");
	nimln(138, "osproc.nim");
	TMP944 = subInt(c->Sup.len, 1);
	HEX3Atmp_145475 = (NI32)(TMP944);
	nimln(1308, "system.nim");
	res_145477 = 1;
	nimln(1309, "system.nim");
	while (1) {
		NI TMP945;
		NimStringDesc* LOC2;
		nimln(1309, "system.nim");
		if (!(res_145477 <= HEX3Atmp_145475)) goto LA1;
		nimln(1308, "system.nim");
		i_145473 = res_145477;
		nimln(138, "osproc.nim");
		nimln(138, "osproc.nim");
		TMP945 = subInt(i_145473, 1);
		if ((NU)((NI32)(TMP945)) >= (NU)(a->Sup.len)) raiseIndexError();
		if ((NU)(i_145473) >= (NU)(c->Sup.len)) raiseIndexError();
		LOC2 = 0;
		LOC2 = a->data[(NI32)(TMP945)]; a->data[(NI32)(TMP945)] = copyStringRC1(c->data[i_145473]);
		if (LOC2) nimGCunrefNoCycle(LOC2);
		nimln(1311, "system.nim");
		res_145477 = addInt(res_145477, 1);
	} LA1: ;
	nimln(139, "osproc.nim");
	if ((NU)(0) >= (NU)(c->Sup.len)) raiseIndexError();
	result = nospstartProcess(c->data[0], ((NimStringDesc*) &TMP933), a->data, a->Sup.len, NIM_NIL, options);
	popFrame();
	return result;
}
N_NIMCALL(NI, nospprocessID)(tprocess145203* p) {
	NI result;
	nimfr("processID", "osproc.nim")
	result = 0;
	nimln(158, "osproc.nim");
	nimln(158, "osproc.nim");
	result = (*p).Id;
	goto BeforeRet;
	BeforeRet: ;	popFrame();
	return result;
}
N_NIMCALL(int, nospinputHandle)(tprocess145203* p) {
	int result;
	nimfr("inputHandle", "osproc.nim")
	result = 0;
	nimln(191, "osproc.nim");
	result = (*p).Inhandle;
	popFrame();
	return result;
}
N_NIMCALL(int, nospoutputHandle)(tprocess145203* p) {
	int result;
	nimfr("outputHandle", "osproc.nim")
	result = 0;
	nimln(199, "osproc.nim");
	result = (*p).Outhandle;
	popFrame();
	return result;
}
N_NIMCALL(int, nosperrorHandle)(tprocess145203* p) {
	int result;
	nimfr("errorHandle", "osproc.nim")
	result = 0;
	nimln(207, "osproc.nim");
	result = (*p).Errhandle;
	popFrame();
	return result;
}
N_NIMCALL(NI, nospcountProcessors)(void) {
	NI result;
	nimfr("countProcessors", "osproc.nim")
	result = 0;
	nimln(243, "osproc.nim");
	result = sysconf(_SC_NPROCESSORS_ONLN);
	nimln(244, "osproc.nim");
	{
		nimln(244, "osproc.nim");
		if (!(result <= 0)) goto LA3;
		nimln(244, "osproc.nim");
		result = 1;
	}	LA3: ;
	popFrame();
	return result;
}N_NIMCALL(void, TMP949)(void* p, NI op) {
	tprocess145203* a;
	a = (tprocess145203*)p;
	nimGCvisit((void*)(*a).Instream, op);
	nimGCvisit((void*)(*a).Outstream, op);
	nimGCvisit((void*)(*a).Errstream, op);
}
N_NIMCALL(void, TMP950)(void* p, NI op) {
	TY146202* a;
	NI LOC1;
	a = (TY146202*)p;
	LOC1 = 0;
	for (LOC1 = 0; LOC1 < a->Sup.len; LOC1++) {
	nimGCvisit((void*)a->data[LOC1], op);
	}
}

static N_INLINE(void, asgnRefNoCycle)(void** dest, void* src) {
	nimfr("asgnRefNoCycle", "gc.nim")
	nimln(249, "gc.nim");
	{
		tcell38848* c;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		if (!!((src == NIM_NIL))) goto LA3;
		nimln(250, "gc.nim");
		c = usrtocell_42239(src);
		nimln(167, "gc.nim");
		(*c).Refcount += 8;
	}	LA3: ;
	nimln(252, "gc.nim");
	{
		tcell38848* c;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		if (!!(((*dest) == NIM_NIL))) goto LA7;
		nimln(253, "gc.nim");
		c = usrtocell_42239((*dest));
		nimln(254, "gc.nim");
		{
			nimln(165, "gc.nim");
			(*c).Refcount -= 8;
			nimln(166, "gc.nim");
			if (!((NU32)((*c).Refcount) < (NU32)(8))) goto LA11;
			nimln(255, "gc.nim");
			rtladdzct_43802(c);		}		LA11: ;
	}	LA7: ;
	nimln(256, "gc.nim");
	(*dest) = src;
	popFrame();
}
N_NIMCALL(NI, nospexecProcesses)(NimStringDesc** cmds, NI cmdsLen0, NU8 options_145808, NI n) {
	NI result;
	NU8 options;
	nimfr("execProcesses", "osproc.nim")
	result = 0;
	nimln(255, "osproc.nim");
	nimln(255, "osproc.nim");
	options = (options_145808 & ~ 8);
	nimln(257, "osproc.nim");
	{
		nimln(257, "osproc.nim");
		nimln(257, "osproc.nim");
		if (!!((0 < n))) goto LA3;
		nimln(257, "osproc.nim");
		hiddenraiseassert_76017(((NimStringDesc*) &TMP946));	}	LA3: ;
	nimln(258, "osproc.nim");
	{
		TY146202* q;
		NI m;
		NI i_146233;
		NI HEX3Atmp_146479;
		NI TMP951;
		NI res_146481;
		NI i;
		NI j_146448;
		NI HEX3Atmp_146487;
		NI TMP957;
		NI res_146489;
		nimln(706, "system.nim");
		if (!(1 < n)) goto LA7;
		q = 0;
		nimln(260, "osproc.nim");
		q = (TY146202*) newSeq((&NTI146202), n);
		nimln(261, "osproc.nim");
		nimln(261, "osproc.nim");
		nimln(261, "osproc.nim");
		m = ((n <= cmdsLen0) ? n : cmdsLen0);
		i_146233 = 0;
		HEX3Atmp_146479 = 0;
		nimln(262, "osproc.nim");
		nimln(262, "osproc.nim");
		TMP951 = subInt(m, 1);
		HEX3Atmp_146479 = (NI32)(TMP951);
		nimln(1308, "system.nim");
		res_146481 = 0;
		nimln(1309, "system.nim");
		while (1) {
			nimln(1309, "system.nim");
			if (!(res_146481 <= HEX3Atmp_146479)) goto LA9;
			nimln(1308, "system.nim");
			i_146233 = res_146481;
			nimln(263, "osproc.nim");
			if ((NU)(i_146233) >= (NU)(q->Sup.len)) raiseIndexError();
			if ((NU)(i_146233) >= (NU)(cmdsLen0)) raiseIndexError();
			asgnRefNoCycle((void**) &q->data[i_146233], startcmd_145428(cmds[i_146233], options));
			nimln(1311, "system.nim");
			res_146481 = addInt(res_146481, 1);
		} LA9: ;
		nimln(279, "osproc.nim");
		i = m;
		nimln(280, "osproc.nim");
		while (1) {
			NI r_146412;
			NI HEX3Atmp_146483;
			NI TMP956;
			NI res_146485;
			nimln(280, "osproc.nim");
			nimln(280, "osproc.nim");
			if (!(i <= (cmdsLen0-1))) goto LA10;
			nimln(281, "osproc.nim");
			nossleep(50);			r_146412 = 0;
			HEX3Atmp_146483 = 0;
			nimln(282, "osproc.nim");
			nimln(282, "osproc.nim");
			TMP956 = subInt(n, 1);
			HEX3Atmp_146483 = (NI32)(TMP956);
			nimln(1308, "system.nim");
			res_146485 = 0;
			nimln(1309, "system.nim");
			while (1) {
				nimln(1309, "system.nim");
				if (!(res_146485 <= HEX3Atmp_146483)) goto LA11;
				nimln(1308, "system.nim");
				r_146412 = res_146485;
				nimln(283, "osproc.nim");
				{
					NIM_BOOL LOC14;
					NI LOC17;
					nimln(283, "osproc.nim");
					nimln(283, "osproc.nim");
					if ((NU)(r_146412) >= (NU)(q->Sup.len)) raiseIndexError();
					LOC14 = 0;
					LOC14 = nosprunning(q->data[r_146412]);
					if (!!(LOC14)) goto LA15;
					nimln(285, "osproc.nim");
					nimln(285, "osproc.nim");
					nimln(285, "osproc.nim");
					if ((NU)(r_146412) >= (NU)(q->Sup.len)) raiseIndexError();
					LOC17 = 0;
					LOC17 = nospwaitForExit(q->data[r_146412], -1);
					result = ((LOC17 >= result) ? LOC17 : result);
					nimln(286, "osproc.nim");
					{
						nimln(698, "system.nim");
						nimln(698, "system.nim");
						if ((NU)(r_146412) >= (NU)(q->Sup.len)) raiseIndexError();
						if (!!((q->data[r_146412] == NIM_NIL))) goto LA20;
						nimln(286, "osproc.nim");
						if ((NU)(r_146412) >= (NU)(q->Sup.len)) raiseIndexError();
						nospclose(q->data[r_146412]);					}					LA20: ;
					nimln(287, "osproc.nim");
					if ((NU)(r_146412) >= (NU)(q->Sup.len)) raiseIndexError();
					if ((NU)(i) >= (NU)(cmdsLen0)) raiseIndexError();
					asgnRefNoCycle((void**) &q->data[r_146412], startcmd_145428(cmds[i], options));
					nimln(288, "osproc.nim");
					i = addInt(i, 1);
					nimln(289, "osproc.nim");
					{
						nimln(706, "system.nim");
						nimln(289, "osproc.nim");
						if (!((cmdsLen0-1) < i)) goto LA24;
						nimln(289, "osproc.nim");
						goto LA11;
					}					LA24: ;
				}				LA15: ;
				nimln(1311, "system.nim");
				res_146485 = addInt(res_146485, 1);
			} LA11: ;
		} LA10: ;
		j_146448 = 0;
		HEX3Atmp_146487 = 0;
		nimln(290, "osproc.nim");
		nimln(290, "osproc.nim");
		TMP957 = subInt(m, 1);
		HEX3Atmp_146487 = (NI32)(TMP957);
		nimln(1308, "system.nim");
		res_146489 = 0;
		nimln(1309, "system.nim");
		while (1) {
			NI LOC27;
			nimln(1309, "system.nim");
			if (!(res_146489 <= HEX3Atmp_146487)) goto LA26;
			nimln(1308, "system.nim");
			j_146448 = res_146489;
			nimln(291, "osproc.nim");
			nimln(291, "osproc.nim");
			nimln(291, "osproc.nim");
			if ((NU)(j_146448) >= (NU)(q->Sup.len)) raiseIndexError();
			LOC27 = 0;
			LOC27 = nospwaitForExit(q->data[j_146448], -1);
			result = ((LOC27 >= result) ? LOC27 : result);
			nimln(292, "osproc.nim");
			{
				nimln(698, "system.nim");
				nimln(698, "system.nim");
				if ((NU)(j_146448) >= (NU)(q->Sup.len)) raiseIndexError();
				if (!!((q->data[j_146448] == NIM_NIL))) goto LA30;
				nimln(292, "osproc.nim");
				if ((NU)(j_146448) >= (NU)(q->Sup.len)) raiseIndexError();
				nospclose(q->data[j_146448]);			}			LA30: ;
			nimln(1311, "system.nim");
			res_146489 = addInt(res_146489, 1);
		} LA26: ;
	}	goto LA5;
	LA7: ;
	{
		NI i_146473;
		NI HEX3Atmp_146491;
		NI res_146493;
		i_146473 = 0;
		HEX3Atmp_146491 = 0;
		nimln(294, "osproc.nim");
		nimln(294, "osproc.nim");
		HEX3Atmp_146491 = (cmdsLen0-1);
		nimln(1308, "system.nim");
		res_146493 = 0;
		nimln(1309, "system.nim");
		while (1) {
			tprocess145203* p;
			NI LOC34;
			nimln(1309, "system.nim");
			if (!(res_146493 <= HEX3Atmp_146491)) goto LA33;
			nimln(1308, "system.nim");
			i_146473 = res_146493;
			nimln(295, "osproc.nim");
			if ((NU)(i_146473) >= (NU)(cmdsLen0)) raiseIndexError();
			p = startcmd_145428(cmds[i_146473], options);
			nimln(296, "osproc.nim");
			nimln(296, "osproc.nim");
			nimln(296, "osproc.nim");
			LOC34 = 0;
			LOC34 = nospwaitForExit(p, -1);
			result = ((LOC34 >= result) ? LOC34 : result);
			nimln(297, "osproc.nim");
			nospclose(p);			nimln(1311, "system.nim");
			res_146493 = addInt(res_146493, 1);
		} LA33: ;
	}	LA5: ;
	popFrame();
	return result;
}
N_NIMCALL(NimStringDesc*, nospexecProcess)(NimStringDesc* command, NU8 options) {
	NimStringDesc* result;
	tprocess145203* p;
	tstream143629* outp;
	NimStringDesc* line;
	nimfr("execProcess", "osproc.nim")
	result = 0;
	nimln(312, "osproc.nim");
	p = startcmd_145428(command, options);
	nimln(313, "osproc.nim");
	outp = nospoutputStream(p);
	nimln(314, "osproc.nim");
	result = copyString(((NimStringDesc*) &TMP958));
	nimln(315, "osproc.nim");
	nimln(315, "osproc.nim");
	line = rawNewString(120);
	nimln(316, "osproc.nim");
	while (1) {
		nimln(317, "osproc.nim");
		{
			NIM_BOOL LOC4;
			nimln(317, "osproc.nim");
			LOC4 = 0;
			LOC4 = readline_143973(outp, &line);
			if (!LOC4) goto LA5;
			nimln(318, "osproc.nim");
			result = resizeString(result, line->Sup.len + 0);
appendString(result, line);
			nimln(319, "osproc.nim");
			result = resizeString(result, 1);
appendString(result, ((NimStringDesc*) &TMP959));
		}		goto LA2;
		LA5: ;
		{
			NIM_BOOL LOC8;
			nimln(320, "osproc.nim");
			nimln(320, "osproc.nim");
			LOC8 = 0;
			LOC8 = nosprunning(p);
			if (!!(LOC8)) goto LA9;
			nimln(320, "osproc.nim");
			goto LA1;
		}		goto LA2;
		LA9: ;
		LA2: ;
	} LA1: ;
	nimln(321, "osproc.nim");
	nospclose(p);	popFrame();
	return result;
}
N_NIMCALL(NimStringDesc*, addcmdargs_146604)(NimStringDesc* command, NimStringDesc** args, NI argsLen0) {
	NimStringDesc* result;
	NI i_146619;
	NI HEX3Atmp_146620;
	NI res_146622;
	nimfr("addCmdArgs", "osproc.nim")
	result = 0;
	nimln(565, "osproc.nim");
	result = nospquoteShell(command);
	i_146619 = 0;
	HEX3Atmp_146620 = 0;
	nimln(566, "osproc.nim");
	nimln(566, "osproc.nim");
	HEX3Atmp_146620 = (argsLen0-1);
	nimln(1308, "system.nim");
	res_146622 = 0;
	nimln(1309, "system.nim");
	while (1) {
		NimStringDesc* LOC2;
		nimln(1309, "system.nim");
		if (!(res_146622 <= HEX3Atmp_146620)) goto LA1;
		nimln(1308, "system.nim");
		i_146619 = res_146622;
		nimln(567, "osproc.nim");
		result = resizeString(result, 1);
appendString(result, ((NimStringDesc*) &TMP960));
		nimln(568, "osproc.nim");
		nimln(568, "osproc.nim");
		if ((NU)(i_146619) >= (NU)(argsLen0)) raiseIndexError();
		LOC2 = 0;
		LOC2 = nospquoteShell(args[i_146619]);
		result = resizeString(result, LOC2->Sup.len + 0);
appendString(result, LOC2);
		nimln(1311, "system.nim");
		res_146622 = addInt(res_146622, 1);
	} LA1: ;
	popFrame();
	return result;
}
N_NIMCALL(NCSTRING*, tocstringarray_146626)(NimStringDesc** b, NI bLen0, NimStringDesc** a, NI aLen0) {
	NCSTRING* result;
	NI TMP961;
	NI TMP962;
	NI TMP963;
	void* LOC1;
	NI i_146654;
	NI HEX3Atmp_146680;
	NI res_146682;
	NI i_146664;
	NI HEX3Atmp_146685;
	NI res_146687;
	nimfr("toCStringArray", "osproc.nim")
	result = 0;
	nimln(571, "osproc.nim");
	nimln(571, "osproc.nim");
	nimln(571, "osproc.nim");
	nimln(571, "osproc.nim");
	nimln(571, "osproc.nim");
	nimln(571, "osproc.nim");
	nimln(571, "osproc.nim");
	TMP961 = addInt(aLen0, bLen0);
	TMP962 = addInt((NI32)(TMP961), 1);
	TMP963 = mulInt((NI32)(TMP962), 4);
	LOC1 = 0;
	LOC1 = alloc0_4004((NI32)(TMP963));
	result = ((NCSTRING*) (LOC1));
	i_146654 = 0;
	HEX3Atmp_146680 = 0;
	nimln(572, "osproc.nim");
	nimln(572, "osproc.nim");
	HEX3Atmp_146680 = (bLen0-1);
	nimln(1308, "system.nim");
	res_146682 = 0;
	nimln(1309, "system.nim");
	while (1) {
		NI TMP964;
		void* LOC3;
		NI TMP965;
		nimln(1309, "system.nim");
		if (!(res_146682 <= HEX3Atmp_146680)) goto LA2;
		nimln(1308, "system.nim");
		i_146654 = res_146682;
		nimln(573, "osproc.nim");
		if ((NU)(i_146654) > (NU)(50000)) raiseIndexError();
		nimln(573, "osproc.nim");
		nimln(573, "osproc.nim");
		nimln(573, "osproc.nim");
		if ((NU)(i_146654) >= (NU)(bLen0)) raiseIndexError();
		TMP964 = addInt(b[i_146654]->Sup.len, 1);
		LOC3 = 0;
		LOC3 = alloc_4001((NI32)(TMP964));
		result[(i_146654)- 0] = ((NCSTRING) (LOC3));
		nimln(574, "osproc.nim");
		if ((NU)(i_146654) > (NU)(50000)) raiseIndexError();
		if ((NU)(i_146654) >= (NU)(bLen0)) raiseIndexError();
		nimln(574, "osproc.nim");
		nimln(574, "osproc.nim");
		if ((NU)(i_146654) >= (NU)(bLen0)) raiseIndexError();
		TMP965 = addInt(b[i_146654]->Sup.len, 1);
		memcpy(((void*) (result[(i_146654)- 0])), ((void*) (b[i_146654]->data)), (NI32)(TMP965));		nimln(1311, "system.nim");
		res_146682 = addInt(res_146682, 1);
	} LA2: ;
	i_146664 = 0;
	HEX3Atmp_146685 = 0;
	nimln(575, "osproc.nim");
	nimln(575, "osproc.nim");
	HEX3Atmp_146685 = (aLen0-1);
	nimln(1308, "system.nim");
	res_146687 = 0;
	nimln(1309, "system.nim");
	while (1) {
		NI TMP966;
		NI TMP967;
		void* LOC5;
		NI TMP968;
		NI TMP969;
		nimln(1309, "system.nim");
		if (!(res_146687 <= HEX3Atmp_146685)) goto LA4;
		nimln(1308, "system.nim");
		i_146664 = res_146687;
		nimln(576, "osproc.nim");
		nimln(576, "osproc.nim");
		nimln(576, "osproc.nim");
		TMP966 = addInt(i_146664, bLen0);
		if ((NU)((NI32)(TMP966)) > (NU)(50000)) raiseIndexError();
		nimln(576, "osproc.nim");
		nimln(576, "osproc.nim");
		nimln(576, "osproc.nim");
		if ((NU)(i_146664) >= (NU)(aLen0)) raiseIndexError();
		TMP967 = addInt(a[i_146664]->Sup.len, 1);
		LOC5 = 0;
		LOC5 = alloc_4001((NI32)(TMP967));
		result[((NI32)(TMP966))- 0] = ((NCSTRING) (LOC5));
		nimln(577, "osproc.nim");
		nimln(577, "osproc.nim");
		nimln(577, "osproc.nim");
		TMP968 = addInt(i_146664, bLen0);
		if ((NU)((NI32)(TMP968)) > (NU)(50000)) raiseIndexError();
		if ((NU)(i_146664) >= (NU)(aLen0)) raiseIndexError();
		nimln(577, "osproc.nim");
		nimln(577, "osproc.nim");
		if ((NU)(i_146664) >= (NU)(aLen0)) raiseIndexError();
		TMP969 = addInt(a[i_146664]->Sup.len, 1);
		memcpy(((void*) (result[((NI32)(TMP968))- 0])), ((void*) (a[i_146664]->data)), (NI32)(TMP969));		nimln(1311, "system.nim");
		res_146687 = addInt(res_146687, 1);
	} LA4: ;
	popFrame();
	return result;
}
N_NIMCALL(NCSTRING*, tocstringarray_146692)(tstringtable112610* t) {
	NCSTRING* result;
	NI LOC1;
	NI TMP970;
	NI TMP971;
	void* LOC2;
	NI i;
	NimStringDesc* key_146698;
	NimStringDesc* val_146699;
	NI h_146716;
	NI HEX3Atmp_146718;
	NI res_146720;
	nimfr("ToCStringArray", "osproc.nim")
	result = 0;
	nimln(580, "osproc.nim");
	nimln(580, "osproc.nim");
	nimln(580, "osproc.nim");
	nimln(580, "osproc.nim");
	nimln(580, "osproc.nim");
	LOC1 = 0;
	LOC1 = nstlen(t);
	TMP970 = addInt(LOC1, 1);
	TMP971 = mulInt((NI32)(TMP970), 4);
	LOC2 = 0;
	LOC2 = alloc0_4004((NI32)(TMP971));
	result = ((NCSTRING*) (LOC2));
	nimln(581, "osproc.nim");
	i = 0;
	key_146698 = 0;
	val_146699 = 0;
	h_146716 = 0;
	HEX3Atmp_146718 = 0;
	nimln(40, "strtabs.nim");
	nimln(40, "strtabs.nim");
	HEX3Atmp_146718 = ((*t).Data->Sup.len-1);
	nimln(1308, "system.nim");
	res_146720 = 0;
	nimln(1309, "system.nim");
	while (1) {
		nimln(1309, "system.nim");
		if (!(res_146720 <= HEX3Atmp_146718)) goto LA3;
		nimln(1308, "system.nim");
		h_146716 = res_146720;
		nimln(41, "strtabs.nim");
		{
			NimStringDesc* x;
			NimStringDesc* LOC8;
			NI TMP973;
			void* LOC9;
			NI TMP974;
			nimln(41, "strtabs.nim");
			nimln(41, "strtabs.nim");
			if ((NU)(h_146716) >= (NU)((*t).Data->Sup.len)) raiseIndexError();
			if (!!((*t).Data->data[h_146716].Field0 == 0)) goto LA6;
			nimln(42, "strtabs.nim");
			if ((NU)(h_146716) >= (NU)((*t).Data->Sup.len)) raiseIndexError();
			key_146698 = (*t).Data->data[h_146716].Field0;
			nimln(42, "strtabs.nim");
			if ((NU)(h_146716) >= (NU)((*t).Data->Sup.len)) raiseIndexError();
			val_146699 = (*t).Data->data[h_146716].Field1;
			nimln(583, "osproc.nim");
			nimln(583, "osproc.nim");
			LOC8 = 0;
			LOC8 = rawNewString(key_146698->Sup.len + val_146699->Sup.len + 1);
appendString(LOC8, key_146698);
appendString(LOC8, ((NimStringDesc*) &TMP972));
appendString(LOC8, val_146699);
			x = LOC8;
			nimln(584, "osproc.nim");
			if ((NU)(i) > (NU)(50000)) raiseIndexError();
			nimln(584, "osproc.nim");
			nimln(584, "osproc.nim");
			nimln(584, "osproc.nim");
			TMP973 = addInt(x->Sup.len, 1);
			LOC9 = 0;
			LOC9 = alloc_4001((NI32)(TMP973));
			result[(i)- 0] = ((NCSTRING) (LOC9));
			nimln(585, "osproc.nim");
			if ((NU)(i) > (NU)(50000)) raiseIndexError();
			if ((NU)(0) > (NU)(x->Sup.len)) raiseIndexError();
			nimln(585, "osproc.nim");
			nimln(585, "osproc.nim");
			TMP974 = addInt(x->Sup.len, 1);
			memcpy(((void*) (result[(i)- 0])), ((void*) (&x->data[0])), (NI32)(TMP974));			nimln(586, "osproc.nim");
			i = addInt(i, 1);
		}		LA6: ;
		nimln(1311, "system.nim");
		res_146720 = addInt(res_146720, 1);
	} LA3: ;
	popFrame();
	return result;
}
N_NIMCALL(NCSTRING*, envtocstringarray_146723)(void) {
	NCSTRING* result;
	NI counter;
	NimStringDesc* key_146727;
	NimStringDesc* val_146728;
	NI i_146756;
	NI HEX3Atmp_146758;
	NI res_146760;
	NI TMP977;
	NI TMP978;
	void* LOC2;
	NI i;
	NimStringDesc* key_146741;
	NimStringDesc* val_146742;
	NI i_146772;
	NI HEX3Atmp_146774;
	NI res_146776;
	nimfr("EnvToCStringArray", "osproc.nim")
	result = 0;
	nimln(589, "osproc.nim");
	counter = 0;
	key_146727 = 0;
	val_146728 = 0;
	nimln(1148, "os.nim");
	getenvvarsc_104202();	i_146756 = 0;
	HEX3Atmp_146758 = 0;
	nimln(1149, "os.nim");
	nimln(1149, "os.nim");
	HEX3Atmp_146758 = (environment_104029->Sup.len-1);
	nimln(1308, "system.nim");
	res_146760 = 0;
	nimln(1309, "system.nim");
	while (1) {
		NI p_146762;
		NI TMP975;
		NI TMP976;
		nimln(1309, "system.nim");
		if (!(res_146760 <= HEX3Atmp_146758)) goto LA1;
		nimln(1308, "system.nim");
		i_146756 = res_146760;
		nimln(1150, "os.nim");
		if ((NU)(i_146756) >= (NU)(environment_104029->Sup.len)) raiseIndexError();
		p_146762 = nsuFindChar(environment_104029->data[i_146756], 61, 0);
		nimln(1151, "os.nim");
		nimln(1151, "os.nim");
		if ((NU)(i_146756) >= (NU)(environment_104029->Sup.len)) raiseIndexError();
		nimln(1151, "os.nim");
		TMP975 = subInt(p_146762, 1);
		key_146727 = copyStrLast(environment_104029->data[i_146756], 0, (NI32)(TMP975));
		nimln(1152, "os.nim");
		nimln(1152, "os.nim");
		if ((NU)(i_146756) >= (NU)(environment_104029->Sup.len)) raiseIndexError();
		nimln(1152, "os.nim");
		TMP976 = addInt(p_146762, 1);
		val_146728 = copyStr(environment_104029->data[i_146756], (NI32)(TMP976));
		nimln(590, "osproc.nim");
		counter = addInt(counter, 1);
		nimln(1311, "system.nim");
		res_146760 = addInt(res_146760, 1);
	} LA1: ;
	nimln(591, "osproc.nim");
	nimln(591, "osproc.nim");
	nimln(591, "osproc.nim");
	nimln(591, "osproc.nim");
	TMP977 = addInt(counter, 1);
	TMP978 = mulInt((NI32)(TMP977), 4);
	LOC2 = 0;
	LOC2 = alloc0_4004((NI32)(TMP978));
	result = ((NCSTRING*) (LOC2));
	nimln(592, "osproc.nim");
	i = 0;
	key_146741 = 0;
	val_146742 = 0;
	nimln(1148, "os.nim");
	getenvvarsc_104202();	i_146772 = 0;
	HEX3Atmp_146774 = 0;
	nimln(1149, "os.nim");
	nimln(1149, "os.nim");
	HEX3Atmp_146774 = (environment_104029->Sup.len-1);
	nimln(1308, "system.nim");
	res_146776 = 0;
	nimln(1309, "system.nim");
	while (1) {
		NI p_146778;
		NI TMP979;
		NI TMP980;
		NimStringDesc* x;
		NimStringDesc* LOC4;
		NI TMP981;
		void* LOC5;
		NI TMP982;
		nimln(1309, "system.nim");
		if (!(res_146776 <= HEX3Atmp_146774)) goto LA3;
		nimln(1308, "system.nim");
		i_146772 = res_146776;
		nimln(1150, "os.nim");
		if ((NU)(i_146772) >= (NU)(environment_104029->Sup.len)) raiseIndexError();
		p_146778 = nsuFindChar(environment_104029->data[i_146772], 61, 0);
		nimln(1151, "os.nim");
		nimln(1151, "os.nim");
		if ((NU)(i_146772) >= (NU)(environment_104029->Sup.len)) raiseIndexError();
		nimln(1151, "os.nim");
		TMP979 = subInt(p_146778, 1);
		key_146741 = copyStrLast(environment_104029->data[i_146772], 0, (NI32)(TMP979));
		nimln(1152, "os.nim");
		nimln(1152, "os.nim");
		if ((NU)(i_146772) >= (NU)(environment_104029->Sup.len)) raiseIndexError();
		nimln(1152, "os.nim");
		TMP980 = addInt(p_146778, 1);
		val_146742 = copyStr(environment_104029->data[i_146772], (NI32)(TMP980));
		nimln(594, "osproc.nim");
		nimln(594, "osproc.nim");
		LOC4 = 0;
		LOC4 = rawNewString(key_146741->Sup.len + val_146742->Sup.len + 1);
appendString(LOC4, key_146741);
appendString(LOC4, ((NimStringDesc*) &TMP972));
appendString(LOC4, val_146742);
		x = LOC4;
		nimln(595, "osproc.nim");
		if ((NU)(i) > (NU)(50000)) raiseIndexError();
		nimln(595, "osproc.nim");
		nimln(595, "osproc.nim");
		nimln(595, "osproc.nim");
		TMP981 = addInt(x->Sup.len, 1);
		LOC5 = 0;
		LOC5 = alloc_4001((NI32)(TMP981));
		result[(i)- 0] = ((NCSTRING) (LOC5));
		nimln(596, "osproc.nim");
		if ((NU)(i) > (NU)(50000)) raiseIndexError();
		if ((NU)(0) > (NU)(x->Sup.len)) raiseIndexError();
		nimln(596, "osproc.nim");
		nimln(596, "osproc.nim");
		TMP982 = addInt(x->Sup.len, 1);
		memcpy(((void*) (result[(i)- 0])), ((void*) (&x->data[0])), (NI32)(TMP982));		nimln(597, "osproc.nim");
		i = addInt(i, 1);
		nimln(1311, "system.nim");
		res_146776 = addInt(res_146776, 1);
	} LA3: ;
	popFrame();
	return result;
}
static N_INLINE(void, setcurrentdir_101803)(NimStringDesc* newdir) {
	nimfr("setCurrentDir", "os.nim")
	nimln(475, "os.nim");
	{
		int LOC3;
		NI32 LOC6;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		nimln(475, "os.nim");
		LOC3 = 0;
		LOC3 = chdir(newdir->data);
		if (!!((LOC3 == ((NI32) 0)))) goto LA4;
		nimln(475, "os.nim");
		nimln(475, "os.nim");
		LOC6 = 0;
		LOC6 = oslasterror_100046();
		oserror_100005(LOC6);	}	LA4: ;
	popFrame();
}
N_NIMCALL(tprocess145203*, nospstartProcess)(NimStringDesc* command, NimStringDesc* workingdir, NimStringDesc** args, NI argsLen0, tstringtable112610* env, NU8 options) {
	tprocess145203* result;
	TY146798 pstdin;
	TY146798 pstdout;
	TY146798 pstderr;
	pid_t pid;
	posix_spawnattr_t attr;
	posix_spawn_file_actions_t fops;
	sigset_t mask;
	NCSTRING* e;
	NCSTRING* a;
	int res;
	int LOC120;
	int LOC121;
	nimfr("startProcess", "osproc.nim")
	result = 0;
	memset((void*)pstdin, 0, sizeof(pstdin));
	memset((void*)pstdout, 0, sizeof(pstdout));
	memset((void*)pstderr, 0, sizeof(pstderr));
	nimln(606, "osproc.nim");
	result = (tprocess145203*) newObj((&NTI145205), sizeof(tprocess145203));
	(*result).Sup.m_type = (&NTI145203);
	nimln(607, "osproc.nim");
	(*result).Exitcode = ((int) -3);
	nimln(608, "osproc.nim");
	{
		nimln(731, "system.nim");
		nimln(731, "system.nim");
		if (!!(((options &(1<<((((NU8) 3))&7)))!=0))) goto LA3;
		nimln(609, "osproc.nim");
		{
			NIM_BOOL LOC7;
			NIM_BOOL LOC8;
			int LOC9;
			int LOC11;
			int LOC13;
			NI32 LOC16;
			nimln(609, "osproc.nim");
			LOC7 = 0;
			nimln(609, "osproc.nim");
			LOC8 = 0;
			nimln(698, "system.nim");
			nimln(698, "system.nim");
			nimln(609, "osproc.nim");
			LOC9 = 0;
			LOC9 = pipe(pstdin);
			LOC8 = !((LOC9 == ((NI32) 0)));
			if (LOC8) goto LA10;
			nimln(698, "system.nim");
			nimln(698, "system.nim");
			nimln(609, "osproc.nim");
			LOC11 = 0;
			LOC11 = pipe(pstdout);
			LOC8 = !((LOC11 == ((NI32) 0)));
			LA10: ;
			LOC7 = LOC8;
			if (LOC7) goto LA12;
			nimln(698, "system.nim");
			nimln(698, "system.nim");
			nimln(610, "osproc.nim");
			LOC13 = 0;
			LOC13 = pipe(pstderr);
			LOC7 = !((LOC13 == ((NI32) 0)));
			LA12: ;
			if (!LOC7) goto LA14;
			nimln(611, "osproc.nim");
			nimln(611, "osproc.nim");
			LOC16 = 0;
			LOC16 = oslasterror_100046();
			oserror_100005(LOC16);		}		LA14: ;
	}	LA3: ;
	pid = 0;
	memset((void*)&attr, 0, sizeof(attr));
	memset((void*)&fops, 0, sizeof(fops));
	nimln(619, "osproc.nim");
	{
		int LOC19;
		NI32 LOC22;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		nimln(621, "osproc.nim");
		LOC19 = 0;
		LOC19 = posix_spawn_file_actions_init(&fops);
		if (!!((LOC19 == ((NI32) 0)))) goto LA20;
		nimln(619, "osproc.nim");
		nimln(619, "osproc.nim");
		LOC22 = 0;
		LOC22 = oslasterror_100046();
		oserror_100005(LOC22);	}	LA20: ;
	nimln(619, "osproc.nim");
	{
		int LOC25;
		NI32 LOC28;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		nimln(622, "osproc.nim");
		LOC25 = 0;
		LOC25 = posix_spawnattr_init(&attr);
		if (!!((LOC25 == ((NI32) 0)))) goto LA26;
		nimln(619, "osproc.nim");
		nimln(619, "osproc.nim");
		LOC28 = 0;
		LOC28 = oslasterror_100046();
		oserror_100005(LOC28);	}	LA26: ;
	memset((void*)&mask, 0, sizeof(mask));
	nimln(619, "osproc.nim");
	{
		int LOC31;
		NI32 LOC34;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		nimln(625, "osproc.nim");
		LOC31 = 0;
		LOC31 = sigemptyset(&mask);
		if (!!((LOC31 == ((NI32) 0)))) goto LA32;
		nimln(619, "osproc.nim");
		nimln(619, "osproc.nim");
		LOC34 = 0;
		LOC34 = oslasterror_100046();
		oserror_100005(LOC34);	}	LA32: ;
	nimln(619, "osproc.nim");
	{
		int LOC37;
		NI32 LOC40;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		nimln(626, "osproc.nim");
		LOC37 = 0;
		LOC37 = posix_spawnattr_setsigmask(&attr, &mask);
		if (!!((LOC37 == ((NI32) 0)))) goto LA38;
		nimln(619, "osproc.nim");
		nimln(619, "osproc.nim");
		LOC40 = 0;
		LOC40 = oslasterror_100046();
		oserror_100005(LOC40);	}	LA38: ;
	nimln(619, "osproc.nim");
	{
		int LOC43;
		NI32 LOC46;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		nimln(627, "osproc.nim");
		LOC43 = 0;
		LOC43 = posix_spawnattr_setpgroup(&attr, 0);
		if (!!((LOC43 == ((NI32) 0)))) goto LA44;
		nimln(619, "osproc.nim");
		nimln(619, "osproc.nim");
		LOC46 = 0;
		LOC46 = oslasterror_100046();
		oserror_100005(LOC46);	}	LA44: ;
	nimln(619, "osproc.nim");
	{
		int LOC49;
		NI32 LOC52;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		nimln(629, "osproc.nim");
		nimln(630, "osproc.nim");
		nimln(629, "osproc.nim");
		LOC49 = 0;
		LOC49 = posix_spawnattr_setflags(&attr, (NI32)((NI32)(((int) 0) | POSIX_SPAWN_SETSIGMASK) | POSIX_SPAWN_SETPGROUP));
		if (!!((LOC49 == ((NI32) 0)))) goto LA50;
		nimln(619, "osproc.nim");
		nimln(619, "osproc.nim");
		LOC52 = 0;
		LOC52 = oslasterror_100046();
		oserror_100005(LOC52);	}	LA50: ;
	nimln(633, "osproc.nim");
	{
		nimln(731, "system.nim");
		nimln(731, "system.nim");
		if (!!(((options &(1<<((((NU8) 3))&7)))!=0))) goto LA55;
		nimln(619, "osproc.nim");
		{
			int LOC59;
			NI32 LOC62;
			nimln(698, "system.nim");
			nimln(698, "system.nim");
			nimln(634, "osproc.nim");
			LOC59 = 0;
			LOC59 = posix_spawn_file_actions_addclose(&fops, pstdin[(1)- 0]);
			if (!!((LOC59 == ((NI32) 0)))) goto LA60;
			nimln(619, "osproc.nim");
			nimln(619, "osproc.nim");
			LOC62 = 0;
			LOC62 = oslasterror_100046();
			oserror_100005(LOC62);		}		LA60: ;
		nimln(619, "osproc.nim");
		{
			int LOC65;
			NI32 LOC68;
			nimln(698, "system.nim");
			nimln(698, "system.nim");
			nimln(635, "osproc.nim");
			LOC65 = 0;
			LOC65 = posix_spawn_file_actions_adddup2(&fops, pstdin[(0)- 0], ((int) 0));
			if (!!((LOC65 == ((NI32) 0)))) goto LA66;
			nimln(619, "osproc.nim");
			nimln(619, "osproc.nim");
			LOC68 = 0;
			LOC68 = oslasterror_100046();
			oserror_100005(LOC68);		}		LA66: ;
		nimln(619, "osproc.nim");
		{
			int LOC71;
			NI32 LOC74;
			nimln(698, "system.nim");
			nimln(698, "system.nim");
			nimln(636, "osproc.nim");
			LOC71 = 0;
			LOC71 = posix_spawn_file_actions_addclose(&fops, pstdout[(0)- 0]);
			if (!!((LOC71 == ((NI32) 0)))) goto LA72;
			nimln(619, "osproc.nim");
			nimln(619, "osproc.nim");
			LOC74 = 0;
			LOC74 = oslasterror_100046();
			oserror_100005(LOC74);		}		LA72: ;
		nimln(619, "osproc.nim");
		{
			int LOC77;
			NI32 LOC80;
			nimln(698, "system.nim");
			nimln(698, "system.nim");
			nimln(637, "osproc.nim");
			LOC77 = 0;
			LOC77 = posix_spawn_file_actions_adddup2(&fops, pstdout[(1)- 0], ((int) 1));
			if (!!((LOC77 == ((NI32) 0)))) goto LA78;
			nimln(619, "osproc.nim");
			nimln(619, "osproc.nim");
			LOC80 = 0;
			LOC80 = oslasterror_100046();
			oserror_100005(LOC80);		}		LA78: ;
		nimln(619, "osproc.nim");
		{
			int LOC83;
			NI32 LOC86;
			nimln(698, "system.nim");
			nimln(698, "system.nim");
			nimln(638, "osproc.nim");
			LOC83 = 0;
			LOC83 = posix_spawn_file_actions_addclose(&fops, pstderr[(0)- 0]);
			if (!!((LOC83 == ((NI32) 0)))) goto LA84;
			nimln(619, "osproc.nim");
			nimln(619, "osproc.nim");
			LOC86 = 0;
			LOC86 = oslasterror_100046();
			oserror_100005(LOC86);		}		LA84: ;
		nimln(639, "osproc.nim");
		{
			nimln(730, "system.nim");
			if (!((options &(1<<((((NU8) 2))&7)))!=0)) goto LA89;
			nimln(619, "osproc.nim");
			{
				int LOC93;
				NI32 LOC96;
				nimln(698, "system.nim");
				nimln(698, "system.nim");
				nimln(640, "osproc.nim");
				LOC93 = 0;
				LOC93 = posix_spawn_file_actions_adddup2(&fops, pstdout[(1)- 0], ((int) 2));
				if (!!((LOC93 == ((NI32) 0)))) goto LA94;
				nimln(619, "osproc.nim");
				nimln(619, "osproc.nim");
				LOC96 = 0;
				LOC96 = oslasterror_100046();
				oserror_100005(LOC96);			}			LA94: ;
		}		goto LA87;
		LA89: ;
		{
			nimln(619, "osproc.nim");
			{
				int LOC100;
				NI32 LOC103;
				nimln(698, "system.nim");
				nimln(698, "system.nim");
				nimln(642, "osproc.nim");
				LOC100 = 0;
				LOC100 = posix_spawn_file_actions_adddup2(&fops, pstderr[(1)- 0], ((int) 2));
				if (!!((LOC100 == ((NI32) 0)))) goto LA101;
				nimln(619, "osproc.nim");
				nimln(619, "osproc.nim");
				LOC103 = 0;
				LOC103 = oslasterror_100046();
				oserror_100005(LOC103);			}			LA101: ;
		}		LA87: ;
	}	LA55: ;
	nimln(644, "osproc.nim");
	nimln(644, "osproc.nim");
	{
		nimln(644, "osproc.nim");
		if (!(env == NIM_NIL)) goto LA106;
		nimln(644, "osproc.nim");
		e = envtocstringarray_146723();
	}	goto LA104;
	LA106: ;
	{
		nimln(644, "osproc.nim");
		e = tocstringarray_146692(env);
	}	LA104: ;
	a = 0;
	res = 0;
	nimln(647, "osproc.nim");
	{
		nimln(706, "system.nim");
		nimln(647, "osproc.nim");
		if (!(0 < workingdir->Sup.len)) goto LA111;
		nimln(647, "osproc.nim");
		setcurrentdir_101803(workingdir);	}	LA111: ;
	nimln(648, "osproc.nim");
	{
		TY114525 LOC117;
		nimln(731, "system.nim");
		nimln(731, "system.nim");
		if (!!(((options &(1<<((((NU8) 1))&7)))!=0))) goto LA115;
		nimln(649, "osproc.nim");
		memset((void*)LOC117, 0, sizeof(LOC117));
		nimln(649, "osproc.nim");
		LOC117[0] = nosextractFilename(command);
		a = tocstringarray_146626(LOC117, 1, args, argsLen0);
		nimln(650, "osproc.nim");
		res = posix_spawn(&pid, command->data, &fops, &attr, a, e);
	}	goto LA113;
	LA115: ;
	{
		NimStringDesc* x;
		TY114525 LOC119;
		nimln(652, "osproc.nim");
		x = addcmdargs_146604(command, args, argsLen0);
		nimln(653, "osproc.nim");
		memset((void*)LOC119, 0, sizeof(LOC119));
		LOC119[0] = copyString(x);
		a = tocstringarray_146626(TMP983, 2, LOC119, 1);
		nimln(654, "osproc.nim");
		res = posix_spawn(&pid, "/bin/sh", &fops, &attr, a, e);
	}	LA113: ;
	nimln(655, "osproc.nim");
	dealloccstringarray_9840(a);	nimln(656, "osproc.nim");
	dealloccstringarray_9840(e);	nimln(657, "osproc.nim");
	nimln(657, "osproc.nim");
	LOC120 = 0;
	LOC120 = posix_spawn_file_actions_destroy(&fops);
	nimln(658, "osproc.nim");
	nimln(658, "osproc.nim");
	LOC121 = 0;
	LOC121 = posix_spawnattr_destroy(&attr);
	nimln(619, "osproc.nim");
	{
		NI32 LOC126;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		if (!!((res == ((NI32) 0)))) goto LA124;
		nimln(619, "osproc.nim");
		nimln(619, "osproc.nim");
		LOC126 = 0;
		LOC126 = oslasterror_100046();
		oserror_100005(LOC126);	}	LA124: ;
	nimln(699, "osproc.nim");
	{
		NimStringDesc* LOC131;
		nimln(730, "system.nim");
		if (!((options &(1<<((((NU8) 0))&7)))!=0)) goto LA129;
		nimln(700, "osproc.nim");
		nimln(700, "osproc.nim");
		LOC131 = 0;
		LOC131 = nsuJoinSep(args, argsLen0, ((NimStringDesc*) &TMP960));
		printf("%s%s%s\012", (command)->data, (((NimStringDesc*) &TMP960))->data, (LOC131)->data);
	}	LA129: ;
	nimln(701, "osproc.nim");
	(*result).Id = pid;
	nimln(703, "osproc.nim");
	{
		nimln(730, "system.nim");
		if (!((options &(1<<((((NU8) 3))&7)))!=0)) goto LA134;
		nimln(705, "osproc.nim");
		(*result).Inhandle = ((int) 0);
		nimln(706, "osproc.nim");
		(*result).Outhandle = ((int) 1);
		nimln(707, "osproc.nim");
		{
			nimln(730, "system.nim");
			if (!((options &(1<<((((NU8) 2))&7)))!=0)) goto LA138;
			nimln(708, "osproc.nim");
			(*result).Errhandle = (*result).Outhandle;
		}		goto LA136;
		LA138: ;
		{
			nimln(710, "osproc.nim");
			(*result).Errhandle = ((int) 2);
		}		LA136: ;
	}	goto LA132;
	LA134: ;
	{
		int LOC148;
		int LOC149;
		int LOC150;
		nimln(712, "osproc.nim");
		(*result).Inhandle = pstdin[(1)- 0];
		nimln(713, "osproc.nim");
		(*result).Outhandle = pstdout[(0)- 0];
		nimln(714, "osproc.nim");
		{
			int LOC146;
			nimln(730, "system.nim");
			if (!((options &(1<<((((NU8) 2))&7)))!=0)) goto LA144;
			nimln(715, "osproc.nim");
			(*result).Errhandle = (*result).Outhandle;
			nimln(716, "osproc.nim");
			nimln(716, "osproc.nim");
			LOC146 = 0;
			LOC146 = close(pstderr[(0)- 0]);
		}		goto LA142;
		LA144: ;
		{
			nimln(718, "osproc.nim");
			(*result).Errhandle = pstderr[(0)- 0];
		}		LA142: ;
		nimln(719, "osproc.nim");
		nimln(719, "osproc.nim");
		LOC148 = 0;
		LOC148 = close(pstderr[(1)- 0]);
		nimln(720, "osproc.nim");
		nimln(720, "osproc.nim");
		LOC149 = 0;
		LOC149 = close(pstdin[(0)- 0]);
		nimln(721, "osproc.nim");
		nimln(721, "osproc.nim");
		LOC150 = 0;
		LOC150 = close(pstdout[(1)- 0]);
	}	LA132: ;
	popFrame();
	return result;
}
N_NIMCALL(void, nospclose)(tprocess145203* p) {
	int LOC13;
	int LOC14;
	int LOC15;
	nimfr("close", "osproc.nim")
	nimln(724, "osproc.nim");
	{
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		if (!!(((*p).Instream == NIM_NIL))) goto LA3;
		nimln(724, "osproc.nim");
		close_143675((*p).Instream);	}	LA3: ;
	nimln(725, "osproc.nim");
	{
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		if (!!(((*p).Outstream == NIM_NIL))) goto LA7;
		nimln(725, "osproc.nim");
		close_143675((*p).Outstream);	}	LA7: ;
	nimln(726, "osproc.nim");
	{
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		if (!!(((*p).Errstream == NIM_NIL))) goto LA11;
		nimln(726, "osproc.nim");
		close_143675((*p).Errstream);	}	LA11: ;
	nimln(727, "osproc.nim");
	nimln(727, "osproc.nim");
	LOC13 = 0;
	LOC13 = close((*p).Inhandle);
	nimln(728, "osproc.nim");
	nimln(728, "osproc.nim");
	LOC14 = 0;
	LOC14 = close((*p).Outhandle);
	nimln(729, "osproc.nim");
	nimln(729, "osproc.nim");
	LOC15 = 0;
	LOC15 = close((*p).Errhandle);
	popFrame();
}
N_NIMCALL(void, nospsuspend)(tprocess145203* p) {
	nimfr("suspend", "osproc.nim")
	nimln(732, "osproc.nim");
	{
		int LOC3;
		NI32 LOC6;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		nimln(732, "osproc.nim");
		nimln(732, "osproc.nim");
		if ((*p).Id == (-2147483647 -1)) raiseOverflow();
		LOC3 = 0;
		LOC3 = kill(((NI32)-((*p).Id)), SIGSTOP);
		if (!!((LOC3 == ((NI32) 0)))) goto LA4;
		nimln(732, "osproc.nim");
		nimln(732, "osproc.nim");
		LOC6 = 0;
		LOC6 = oslasterror_100046();
		oserror_100005(LOC6);	}	LA4: ;
	popFrame();
}
N_NIMCALL(void, nospresume)(tprocess145203* p) {
	nimfr("resume", "osproc.nim")
	nimln(735, "osproc.nim");
	{
		int LOC3;
		NI32 LOC6;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		nimln(735, "osproc.nim");
		nimln(735, "osproc.nim");
		if ((*p).Id == (-2147483647 -1)) raiseOverflow();
		LOC3 = 0;
		LOC3 = kill(((NI32)-((*p).Id)), SIGCONT);
		if (!!((LOC3 == ((NI32) 0)))) goto LA4;
		nimln(735, "osproc.nim");
		nimln(735, "osproc.nim");
		LOC6 = 0;
		LOC6 = oslasterror_100046();
		oserror_100005(LOC6);	}	LA4: ;
	popFrame();
}
N_NIMCALL(NIM_BOOL, nosprunning)(tprocess145203* p) {
	NIM_BOOL result;
	pid_t ret;
	nimfr("running", "osproc.nim")
	result = 0;
	nimln(738, "osproc.nim");
	ret = waitpid((*p).Id, &(*p).Exitcode, WNOHANG);
	nimln(739, "osproc.nim");
	{
		nimln(739, "osproc.nim");
		if (!(ret == 0)) goto LA3;
		nimln(739, "osproc.nim");
		nimln(739, "osproc.nim");
		result = NIM_TRUE;
		goto BeforeRet;
	}	LA3: ;
	nimln(740, "osproc.nim");
	nimln(740, "osproc.nim");
	result = (ret == (*p).Id);
	BeforeRet: ;	popFrame();
	return result;
}
N_NIMCALL(void, nospterminate)(tprocess145203* p) {
	nimfr("terminate", "osproc.nim")
	nimln(743, "osproc.nim");
	{
		int LOC3;
		nimln(743, "osproc.nim");
		nimln(743, "osproc.nim");
		nimln(743, "osproc.nim");
		if ((*p).Id == (-2147483647 -1)) raiseOverflow();
		LOC3 = 0;
		LOC3 = kill(((NI32)-((*p).Id)), SIGTERM);
		if (!(LOC3 == ((NI32) 0))) goto LA4;
		nimln(744, "osproc.nim");
		{
			NIM_BOOL LOC8;
			nimln(744, "osproc.nim");
			LOC8 = 0;
			LOC8 = nosprunning(p);
			if (!LOC8) goto LA9;
			nimln(745, "osproc.nim");
			{
				int LOC13;
				NI32 LOC16;
				nimln(698, "system.nim");
				nimln(698, "system.nim");
				nimln(745, "osproc.nim");
				nimln(745, "osproc.nim");
				if ((*p).Id == (-2147483647 -1)) raiseOverflow();
				LOC13 = 0;
				LOC13 = kill(((NI32)-((*p).Id)), SIGKILL);
				if (!!((LOC13 == ((NI32) 0)))) goto LA14;
				nimln(745, "osproc.nim");
				nimln(745, "osproc.nim");
				LOC16 = 0;
				LOC16 = oslasterror_100046();
				oserror_100005(LOC16);			}			LA14: ;
		}		LA9: ;
	}	goto LA1;
	LA4: ;
	{
		NI32 LOC18;
		nimln(746, "osproc.nim");
		nimln(746, "osproc.nim");
		LOC18 = 0;
		LOC18 = oslasterror_100046();
		oserror_100005(LOC18);	}	LA1: ;
	popFrame();
}
N_NIMCALL(NI, nospwaitForExit)(tprocess145203* p, NI timeout) {
	NI result;
	nimfr("waitForExit", "osproc.nim")
	result = 0;
	nimln(753, "osproc.nim");
	{
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		if (!!(((*p).Exitcode == ((NI32) -3)))) goto LA3;
		nimln(753, "osproc.nim");
		nimln(753, "osproc.nim");
		result = ((NI) ((*p).Exitcode));
		goto BeforeRet;
	}	LA3: ;
	nimln(754, "osproc.nim");
	{
		pid_t LOC7;
		NI32 LOC10;
		nimln(754, "osproc.nim");
		nimln(754, "osproc.nim");
		LOC7 = 0;
		LOC7 = waitpid((*p).Id, &(*p).Exitcode, ((int) 0));
		if (!(LOC7 < 0)) goto LA8;
		nimln(755, "osproc.nim");
		(*p).Exitcode = ((int) -3);
		nimln(756, "osproc.nim");
		nimln(756, "osproc.nim");
		LOC10 = 0;
		LOC10 = oslasterror_100046();
		oserror_100005(LOC10);	}	LA8: ;
	nimln(757, "osproc.nim");
	nimln(757, "osproc.nim");
	result = (NI)((NU32)(((NI) ((*p).Exitcode))) >> (NU32)(8));
	BeforeRet: ;	popFrame();
	return result;
}
N_NIMCALL(NI, peekexitcode_145513)(tprocess145203* p) {
	NI result;
	pid_t ret;
	NIM_BOOL b;
	nimfr("peekExitCode", "osproc.nim")
	result = 0;
	nimln(760, "osproc.nim");
	{
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		if (!!(((*p).Exitcode == ((NI32) -3)))) goto LA3;
		nimln(760, "osproc.nim");
		nimln(760, "osproc.nim");
		result = ((NI) ((*p).Exitcode));
		goto BeforeRet;
	}	LA3: ;
	nimln(761, "osproc.nim");
	ret = waitpid((*p).Id, &(*p).Exitcode, WNOHANG);
	nimln(762, "osproc.nim");
	nimln(762, "osproc.nim");
	b = (ret == (*p).Id);
	nimln(763, "osproc.nim");
	{
		if (!b) goto LA7;
		nimln(763, "osproc.nim");
		result = -1;
	}	LA7: ;
	nimln(764, "osproc.nim");
	{
		nimln(764, "osproc.nim");
		if (!((*p).Exitcode == ((NI32) -3))) goto LA11;
		nimln(764, "osproc.nim");
		result = -1;
	}	goto LA9;
	LA11: ;
	{
		nimln(765, "osproc.nim");
		nimln(765, "osproc.nim");
		result = (NI)((NU32)(((NI) ((*p).Exitcode))) >> (NU32)(8));
	}	LA9: ;
	BeforeRet: ;	popFrame();
	return result;
}
N_NIMCALL(void, createstream_147260)(tstream143629** stream, NI32* handle, NU8 filemode) {
	FILE* f;
	tfilestream144109* LOC7;
	nimfr("createStream", "osproc.nim")
	f = 0;
	nimln(770, "osproc.nim");
	{
		NIM_BOOL LOC3;
		NI32 LOC6;
		nimln(770, "osproc.nim");
		nimln(770, "osproc.nim");
		LOC3 = 0;
		LOC3 = open_9211(&f, (*handle), filemode);
		if (!!(LOC3)) goto LA4;
		nimln(770, "osproc.nim");
		nimln(770, "osproc.nim");
		LOC6 = 0;
		LOC6 = oslasterror_100046();
		oserror_100005(LOC6);	}	LA4: ;
	nimln(771, "osproc.nim");
	nimln(771, "osproc.nim");
	LOC7 = 0;
	LOC7 = newfilestream_144167(f);
	unsureAsgnRef((void**) &(*stream), &LOC7->Sup);
	popFrame();
}
N_NIMCALL(tstream143629*, nospinputStream)(tprocess145203* p) {
	tstream143629* result;
	nimfr("inputStream", "osproc.nim")
	result = 0;
	nimln(774, "osproc.nim");
	{
		nimln(774, "osproc.nim");
		if (!((*p).Instream == NIM_NIL)) goto LA3;
		nimln(775, "osproc.nim");
		createstream_147260(&(*p).Instream, &(*p).Inhandle, ((NU8) 1));	}	LA3: ;
	nimln(776, "osproc.nim");
	nimln(776, "osproc.nim");
	result = (*p).Instream;
	goto BeforeRet;
	BeforeRet: ;	popFrame();
	return result;
}
N_NIMCALL(tstream143629*, nospoutputStream)(tprocess145203* p) {
	tstream143629* result;
	nimfr("outputStream", "osproc.nim")
	result = 0;
	nimln(779, "osproc.nim");
	{
		nimln(779, "osproc.nim");
		if (!((*p).Outstream == NIM_NIL)) goto LA3;
		nimln(780, "osproc.nim");
		createstream_147260(&(*p).Outstream, &(*p).Outhandle, ((NU8) 0));	}	LA3: ;
	nimln(781, "osproc.nim");
	nimln(781, "osproc.nim");
	result = (*p).Outstream;
	goto BeforeRet;
	BeforeRet: ;	popFrame();
	return result;
}
N_NIMCALL(tstream143629*, nosperrorStream)(tprocess145203* p) {
	tstream143629* result;
	nimfr("errorStream", "osproc.nim")
	result = 0;
	nimln(784, "osproc.nim");
	{
		nimln(784, "osproc.nim");
		if (!((*p).Errstream == NIM_NIL)) goto LA3;
		nimln(785, "osproc.nim");
		createstream_147260(&(*p).Errstream, &(*p).Errhandle, ((NU8) 0));	}	LA3: ;
	nimln(786, "osproc.nim");
	nimln(786, "osproc.nim");
	result = (*p).Errstream;
	goto BeforeRet;
	BeforeRet: ;	popFrame();
	return result;
}
N_NIMCALL(NI, nospexecCmd)(NimStringDesc* command) {
	NI result;
	int LOC1;
	nimfr("execCmd", "osproc.nim")
	result = 0;
	nimln(791, "osproc.nim");
	nimln(791, "osproc.nim");
	LOC1 = 0;
	LOC1 = system(command->data);
	result = ((NI) (LOC1));
	popFrame();
	return result;
}
N_NIMCALL(void, createfdset_147336)(fd_set* fd, TY146202* s, NI* m) {
	tprocess145203* i_147375;
	NI i_147388;
	nimfr("createFdSet", "osproc.nim")
	nimln(794, "osproc.nim");
	FD_ZERO(fd);	i_147375 = 0;
	nimln(1393, "system.nim");
	i_147388 = 0;
	nimln(1394, "system.nim");
	while (1) {
		nimln(1394, "system.nim");
		nimln(1394, "system.nim");
		if (!(i_147388 < s->Sup.len)) goto LA1;
		nimln(1395, "system.nim");
		if ((NU)(i_147388) >= (NU)(s->Sup.len)) raiseIndexError();
		i_147375 = s->data[i_147388];
		nimln(796, "osproc.nim");
		nimln(796, "osproc.nim");
		(*m) = (((*m) >= ((NI) ((*i_147375).Outhandle))) ? (*m) : ((NI) ((*i_147375).Outhandle)));
		nimln(797, "osproc.nim");
		FD_SET((*i_147375).Outhandle, fd);		nimln(1396, "system.nim");
		i_147388 = addInt(i_147388, 1);
	} LA1: ;
	popFrame();
}
N_NIMCALL(void, pruneprocessset_147391)(TY146202** s, fd_set* fd) {
	NI i;
	NI l;
	nimfr("pruneProcessSet", "osproc.nim")
	nimln(800, "osproc.nim");
	i = 0;
	nimln(801, "osproc.nim");
	nimln(801, "osproc.nim");
	l = (*s)->Sup.len;
	nimln(802, "osproc.nim");
	while (1) {
		nimln(802, "osproc.nim");
		if (!(i < l)) goto LA1;
		nimln(803, "osproc.nim");
		{
			int LOC4;
			NI TMP988;
			nimln(698, "system.nim");
			nimln(698, "system.nim");
			nimln(803, "osproc.nim");
			if ((NU)(i) >= (NU)((*s)->Sup.len)) raiseIndexError();
			LOC4 = 0;
			LOC4 = FD_ISSET((*(*s)->data[i]).Outhandle, fd);
			if (!!((LOC4 == ((NI32) 0)))) goto LA5;
			nimln(804, "osproc.nim");
			if ((NU)(i) >= (NU)((*s)->Sup.len)) raiseIndexError();
			nimln(804, "osproc.nim");
			TMP988 = subInt(l, 1);
			if ((NU)((NI32)(TMP988)) >= (NU)((*s)->Sup.len)) raiseIndexError();
			asgnRefNoCycle((void**) &(*s)->data[i], (*s)->data[(NI32)(TMP988)]);
			nimln(805, "osproc.nim");
			l = subInt(l, 1);
		}		goto LA2;
		LA5: ;
		{
			nimln(807, "osproc.nim");
			i = addInt(i, 1);
		}		LA2: ;
	} LA1: ;
	nimln(808, "osproc.nim");
	(*s) = (TY146202*) setLengthSeq(&((*s))->Sup, sizeof(tprocess145203*), l);
	popFrame();
}
N_NIMCALL(NI, select_146502)(TY146202** readfds, NI timeout) {
	NI result;
	struct timeval tv;
	NI TMP989;
	fd_set rd;
	NI m;
	nimfr("select", "osproc.nim")
	result = 0;
	memset((void*)&tv, 0, sizeof(tv));
	nimln(812, "osproc.nim");
	tv.tv_sec = 0;
	nimln(813, "osproc.nim");
	nimln(813, "osproc.nim");
	TMP989 = mulInt(timeout, 1000);
	tv.tv_usec = (NI32)(TMP989);
	memset((void*)&rd, 0, sizeof(rd));
	nimln(816, "osproc.nim");
	m = 0;
	nimln(817, "osproc.nim");
	createfdset_147336(&rd, (*readfds), &m);	nimln(819, "osproc.nim");
	{
		NI TMP990;
		int LOC5;
		nimln(698, "system.nim");
		nimln(698, "system.nim");
		if (!!((timeout == -1))) goto LA3;
		nimln(820, "osproc.nim");
		nimln(820, "osproc.nim");
		nimln(820, "osproc.nim");
		TMP990 = addInt(m, 1);
		LOC5 = 0;
		LOC5 = select(((int) ((NI32)(TMP990))), &rd, NIM_NIL, NIM_NIL, &tv);
		result = ((NI) (LOC5));
	}	goto LA1;
	LA3: ;
	{
		NI TMP991;
		int LOC7;
		nimln(822, "osproc.nim");
		nimln(822, "osproc.nim");
		nimln(822, "osproc.nim");
		TMP991 = addInt(m, 1);
		LOC7 = 0;
		LOC7 = select(((int) ((NI32)(TMP991))), &rd, NIM_NIL, NIM_NIL, NIM_NIL);
		result = ((NI) (LOC7));
	}	LA1: ;
	nimln(824, "osproc.nim");
	pruneprocessset_147391(readfds, &rd);	popFrame();
	return result;
}
N_NIMCALL(void, execcmdex_147602)(NimStringDesc* command, NU8 options, TY75888* Result) {
	tprocess145203* p;
	tstream143629* outp;
	NimStringDesc* line;
	nimfr("execCmdEx", "osproc.nim")
	nimln(833, "osproc.nim");
	p = startcmd_145428(command, options);
	nimln(834, "osproc.nim");
	outp = nospoutputStream(p);
	nimln(835, "osproc.nim");
	unsureAsgnRef((void**) &(*Result).Field0, copyString(TMP992.Field0));
	(*Result).Field1 = TMP992.Field1;
	nimln(836, "osproc.nim");
	nimln(836, "osproc.nim");
	line = rawNewString(120);
	nimln(837, "osproc.nim");
	while (1) {
		nimln(838, "osproc.nim");
		{
			NIM_BOOL LOC4;
			nimln(838, "osproc.nim");
			LOC4 = 0;
			LOC4 = readline_143973(outp, &line);
			if (!LOC4) goto LA5;
			nimln(839, "osproc.nim");
			(*Result).Field0 = resizeString((*Result).Field0, line->Sup.len + 0);
appendString((*Result).Field0, line);
			nimln(840, "osproc.nim");
			(*Result).Field0 = resizeString((*Result).Field0, 1);
appendString((*Result).Field0, ((NimStringDesc*) &TMP959));
		}		goto LA2;
		LA5: ;
		{
			nimln(842, "osproc.nim");
			(*Result).Field1 = peekexitcode_145513(p);
			nimln(843, "osproc.nim");
			{
				nimln(698, "system.nim");
				nimln(698, "system.nim");
				if (!!(((*Result).Field1 == -1))) goto LA10;
				nimln(843, "osproc.nim");
				goto LA1;
			}			LA10: ;
		}		LA2: ;
	} LA1: ;
	nimln(844, "osproc.nim");
	nospclose(p);	popFrame();
}N_NOINLINE(void, pureosprocInit)(void) {
	nimfr("osproc", "osproc.nim")
	popFrame();
}

N_NOINLINE(void, pureosprocDatInit)(void) {
static TNimNode* TMP947[8];
static TNimNode TMP918[9];
NTI145203.size = sizeof(tprocess145203);
NTI145203.kind = 17;
NTI145203.base = (&NTI1009);
NTI145203.flags = 2;
TMP947[0] = &TMP918[1];
TMP918[1].kind = 1;
TMP918[1].offset = offsetof(tprocess145203, Inhandle);
TMP918[1].typ = (&NTI9008);
TMP918[1].name = "inHandle";
TMP947[1] = &TMP918[2];
TMP918[2].kind = 1;
TMP918[2].offset = offsetof(tprocess145203, Outhandle);
TMP918[2].typ = (&NTI9008);
TMP918[2].name = "outHandle";
TMP947[2] = &TMP918[3];
TMP918[3].kind = 1;
TMP918[3].offset = offsetof(tprocess145203, Errhandle);
TMP918[3].typ = (&NTI9008);
TMP918[3].name = "errHandle";
TMP947[3] = &TMP918[4];
TMP918[4].kind = 1;
TMP918[4].offset = offsetof(tprocess145203, Instream);
TMP918[4].typ = (&NTI143627);
TMP918[4].name = "inStream";
TMP947[4] = &TMP918[5];
TMP918[5].kind = 1;
TMP918[5].offset = offsetof(tprocess145203, Outstream);
TMP918[5].typ = (&NTI143627);
TMP918[5].name = "outStream";
TMP947[5] = &TMP918[6];
TMP918[6].kind = 1;
TMP918[6].offset = offsetof(tprocess145203, Errstream);
TMP918[6].typ = (&NTI143627);
TMP918[6].name = "errStream";
TMP947[6] = &TMP918[7];
TMP918[7].kind = 1;
TMP918[7].offset = offsetof(tprocess145203, Id);
TMP918[7].typ = (&NTI91457);
TMP918[7].name = "id";
TMP947[7] = &TMP918[8];
TMP918[8].kind = 1;
TMP918[8].offset = offsetof(tprocess145203, Exitcode);
TMP918[8].typ = (&NTI3809);
TMP918[8].name = "exitCode";
TMP918[0].len = 8; TMP918[0].kind = 2; TMP918[0].sons = &TMP947[0];
NTI145203.node = &TMP918[0];
NTI145205.size = sizeof(tprocess145203*);
NTI145205.kind = 22;
NTI145205.base = (&NTI145203);
NTI145205.flags = 2;
NTI145205.marker = TMP949;
NTI146202.size = sizeof(TY146202*);
NTI146202.kind = 24;
NTI146202.base = (&NTI145205);
NTI146202.flags = 2;
NTI146202.marker = TMP950;
}

